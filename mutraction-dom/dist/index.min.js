"use strict";var A=Symbol("RecordMutation"),F=Symbol("TrackerOf"),S=Symbol("ProxyOf"),j=Symbol("RecordDependency"),V=Symbol("GetOriginal"),J=["copyWithin","fill","pop","push","reverse","shift","sort","splice","unshift"];function K(e){return typeof e=="string"?D(e):typeof e=="number"&&(e&2147483647)===e}function D(e){return typeof e!="string"||!/^\d{1,10}$/.test(e)?!1:parseInt(e,10)<2147483647}function Q(e){return Object.prototype.toString.call(e)==="[object Arguments]"}function X(e,t){Object.defineProperty(e,S,{enumerable:!1,writable:!0,configurable:!1}),e[S]=t}var Y=new Set([RegExp,Promise]);function N(e){return!(e==null||typeof e!="object"||x(e)||Y.has(e.constructor))}function M(e,t){function r(o,i,u){if(i===F)return t;if(i===V)return o;t[j](g(o,i));let h=Reflect.get(o,i,u);if(N(h)){const d=h,y=M(d,t);h=o[i]=new Proxy(d,y),X(d,h)}if(typeof h=="function"&&t.options.autoTransactionalize&&i!=="constructor"){let d=function(){const k=t.startTransaction(y.name??"auto");try{return y.apply(u,arguments)}finally{k.operations.length>0?t.commit(k):t.rollback(k)}};var b=d;const y=h;return d}return h}function s(o,i,u){if(typeof i=="string"&&J.includes(i)){let b=function(){const y=t.startTransaction(String(i)),k=d.apply(u,arguments);return t.commit(y),k};var h=b;const d=o[i];return b}else return r(o,i,u)}let n=0;function l(o,i,u,h){if(N(u)){const k=M(u,t);u=new Proxy(u,k)}const b=i in o?{type:"change",target:o,name:i,oldValue:e[i],newValue:u}:{type:"create",target:o,name:i,newValue:u},d=n,y=Reflect.set(o,i,u,h);return y&&d==n++&&t[A](b),y}function c(o,i,u,h){if(!Array.isArray(o))throw Error("This object used to be an array.  Expected an array.");if(i==="length"){K(u)||(o.length=u);const b=o.length,d=parseInt(u,10);if(d<b){const y=Object.freeze(o.slice(d,b)),k={type:"arrayshorten",target:o,name:i,oldLength:b,newLength:d,removed:y},q=Reflect.set(o,i,u,h);return t[A](k),++n,q}}if(D(i)){const b=parseInt(i,10);if(b>=o.length){const d={type:"arrayextend",target:o,name:i,oldLength:o.length,newIndex:b,newValue:u},y=Reflect.set(o,i,u,h);return t[A](d),++n,y}}return l(o,i,u,h)}function a(o,i){const u={type:"delete",target:o,name:i,oldValue:e[i]},h=Reflect.deleteProperty(o,i);return h&&t[A](u),h}let p=l,f=r;if(Array.isArray(e)&&(p=c,t.options.trackHistory&&(f=s)),Q(e))throw Error("Tracking of exotic arguments objects not supported");return{get:f,set:p,deleteProperty:a}}function x(e){return typeof e=="object"&&!!e[F]}var W=class{object;prop;#e=new Set;#t=!1;get subscribers(){return this.#e}constructor(e,t){!x(e)&&e[S]&&(e=e[S]),this.object=e,this.prop=t}subscribe(e){return this.#e.add(e),{dispose:()=>{this.#e.delete(e)}}}notifySubscribers(){this.#t&&console.warn(`Re-entrant property subscription for '${String(this.prop)}'`);const e=Array.from(this.#e);this.#t=!0;for(const t of e)t.notifySubscribers();this.#t=!1}get current(){return this.object[this.prop]}set current(e){this.object[this.prop]=e}},H=new WeakMap;function g(e,t){let r=H.get(e);r||H.set(e,r=new Map);let s=r.get(t);return s||r.set(t,s=new W(e,t)),s}var L=class{#e=new Map;#t;#r=!1;#s=new Set;active=!0;constructor(e){this.#t=e}get trackedProperties(){return Array.from(this.#e.keys())}addDependency(e){if(this.active&&!this.#r){if(this.#e.has(e))return;const t=e.subscribe(this);this.#e.set(e,t)}}subscribe(e){return this.#s.add(e),{dispose:()=>this.#s.delete(e)}}notifySubscribers(){const e=Array.from(this.#s);for(const t of e)t()}endDependencyTrack(){this.#t.endDependencyTrack(this)}trackAllChanges(){if(this.#r)return;this.untrackAll();const e=g(this.#t,"history");this.addDependency(e),this.#r=!0}untrackAll(){for(const e of this.#e.values())e.dispose();this.#e.clear()}};function Z({operations:e}){for(let t=0;t<e.length;){const r=e[t];if(r.type==="transaction")e.splice(t,1,...r.operations);else if(r.type==="change"&&Object.is(r.oldValue,r.newValue))e.splice(t,1);else if(t>0){const s=e[t-1];if(s.type==="transaction")throw Error("Internal mutraction error.  Found internal transaction on look-back during packTransaction.");s.target!==r.target||s.name!==r.name?++t:s.type==="create"&&r.type==="change"?e.splice(--t,2,{...s,newValue:r.newValue}):s.type==="create"&&r.type==="delete"?e.splice(--t,2):s.type==="change"&&r.type==="change"?e.splice(--t,2,{...s,newValue:r.newValue}):s.type==="change"&&r.type==="delete"?e.splice(--t,2,{...r,oldValue:s.oldValue}):s.type==="delete"&&r.type==="create"?e.splice(--t,2,{...r,...s,type:"change"}):++t}else++t}}var C={trackHistory:!0,autoTransactionalize:!0,compactOnCommit:!0},$=class{#e;#t;#r=[];#s=!1;options=C;#o;constructor(e={}){this.setOptions(e)}setOptions(e={}){if(this.#s)throw Error("Cannot change options for a tracker that has already started tracking");e.trackHistory===!1&&(e.compactOnCommit??=!1,e.autoTransactionalize??=!1);const t={...C,...e};if(t.autoTransactionalize&&!t.trackHistory)throw Error("Option autoTransactionalize requires option trackHistory");if(t.compactOnCommit&&!t.trackHistory)throw Error("Option compactOnCommit requires option trackHistory");t.trackHistory&&(this.#t=[]),this.options=Object.freeze(t)}track(e){if(x(e))throw Error("Object already tracked");this.#s=!0;const t=new Proxy(e,M(e,this));return Object.defineProperty(e,S,{enumerable:!1,writable:!0,configurable:!1}),e[S]=t,t}trackAsReadonlyDeep(e){return this.track(e)}#n(){if(!this.options.trackHistory)throw Error("History tracking disabled.")}get history(){if(this.#n(),this.#i[0]?.trackAllChanges(),this.#o??=g(this,"history"),!this.#t)throw Error("History tracking enabled, but no root transaction. Probably mutraction internal error.");return this.#t}startTransaction(e){return this.#n(),this.#e={type:"transaction",parent:this.#e,operations:[],dependencies:new Set},e&&(this.#e.transactionName=e),this.#e}commit(e){if(this.#n(),!this.#e)throw Error("Attempted to commit transaction when none were open.");if(e&&e!==this.#e)throw Error("Attempted to commit wrong transaction. Transactions must be resolved in stack order.");if(this.options.compactOnCommit&&Z(this.#e),this.#e.parent)this.#e.parent.operations.push(this.#e),this.#e.dependencies.forEach(t=>this.#e.parent.dependencies.add(t)),this.#e=this.#e.parent;else{this.#t.push(this.#e);const t=new Set;for(const r of this.#e.dependencies)for(const s of r.subscribers)t.add(s);t.forEach(r=>r.notifySubscribers()),this.#e=void 0}this.#e==null&&this.#o?.notifySubscribers()}rollback(e){if(this.#n(),e&&e!==this.#e)throw Error("Attempted to commit wrong transaction. Transactions must be resolved in stack order.");if(this.#e){for(;this.#e.operations.length;)this.undo();this.#e=this.#e.parent}else for(;this.#t.length;)this.undo()}undo(){this.#n();const e=(this.#e?.operations??this.#t).pop();e&&(this.#l(e),this.#r.unshift(e),this.#e==null&&this.#o?.notifySubscribers())}#l(e){if(e.type==="transaction")for(let t=e.operations.length;t-- >0;)this.#l(e.operations[t]);else{const t=e.target;switch(e.type){case"change":case"delete":t[e.name]=e.oldValue;break;case"create":delete t[e.name];break;case"arrayextend":t.length=e.oldLength;break;case"arrayshorten":t.push(...e.removed);break;default:}this.#e||(g(e.target,e.name).notifySubscribers(),(e.type==="arrayextend"||e.type==="arrayshorten")&&g(e.target,"length").notifySubscribers())}}redo(){this.#n();const e=this.#r.shift();e&&(this.#p(e),(this.#e?.operations??this.#t).push(e),this.#e==null&&this.#o?.notifySubscribers())}#p(e){if(e.type==="transaction")for(const t of e.operations)this.#p(t);else{const t=e.target;switch(e.type){case"change":case"create":t[e.name]=e.newValue;break;case"delete":delete t[e.name];break;case"arrayextend":t[e.newIndex]=e.newValue;break;case"arrayshorten":t.length=e.newLength;break;default:}this.#e||(g(e.target,e.name).notifySubscribers(),(e.type==="arrayextend"||e.type==="arrayshorten")&&g(e.target,"length").notifySubscribers())}}clearRedos(){this.#r.length=0}clearHistory(){this.#n(),this.#e=void 0,this.#t.length=0,this.clearRedos()}[A](e){this.options.trackHistory&&(this.#e?.operations??this.#t).push(Object.freeze(e)),this.clearRedos(),this.#e?(this.#e.dependencies.add(g(e.target,e.name)),(e.type==="arrayextend"||e.type==="arrayshorten")&&this.#e.dependencies.add(g(e.target,"length"))):(g(e.target,e.name).notifySubscribers(),(e.type==="arrayextend"||e.type==="arrayshorten")&&g(e.target,"length").notifySubscribers(),this.#o?.notifySubscribers())}#i=[];startDependencyTrack(){const e=new L(this);return this.#i.unshift(e),e}endDependencyTrack(e){if(this.#i[0]!==e)throw Error("Specified dependency list is not top of stack");return this.#i.shift(),e}[j](e){this.#i[0]?.addDependency(e),this.#c&&(this.#a=e)}#c=!1;#a=void 0;getPropRef(e){const t=this.getPropRefTolerant(e);if(!t)throw Error("No tracked properties.  Prop ref detection requires a tracked object.");return t}getPropRefTolerant(e){if(this.#c)throw Error("Cannot be called re-entrantly.");this.#c=!0,this.#a=void 0;try{const t=e();if(!this.#a)return;const r=this.#a.current;return Object.is(t,r)||console.error("The last operation of the callback must be a property get.\n`(foo || bar).quux` is allowed, but `foo.bar + 1` is not"),this.#a}finally{this.#c=!1}}},E=new $;function _(e){return E.track(e)}var ee={dispose:()=>{}};function w(e,t={}){const{tracker:r=E,suppressUntrackedWarning:s=!1}=t;let n=r.startDependencyTrack(),l;try{l=e(n)}finally{n.endDependencyTrack()}if(n.trackedProperties.length===0)return s||console.warn("effect() callback has no dependencies on any tracked properties.  It will not fire again."),ee;let c=n.subscribe(p);const a=()=>{n.untrackAll(),c.dispose()};function p(){l?.(),a(),n=r.startDependencyTrack(),l=e(n),n.endDependencyTrack(),c=n.subscribe(p)}return{dispose:a}}var te={suppressUntrackedWarning:!0};function O(e){w(e,te)}function re(e){return e!=null&&typeof e=="object"&&"$muType"in e&&typeof e.$muType=="string"}function z(e,t){if(Array.isArray(t)){t.forEach(r=>z(e,r));return}if(!re(t))throw Error("Expected a node modifier for 'mu:apply', but got "+typeof t);switch(t.$muType){case"attribute":e.setAttribute(t.name,t.value);break;default:throw Error("Unknown node modifier type: "+t.$muType)}}function ne(e,t,r,...s){const n=document.createElement(e);n.append(...s);let l;for(let[a,p]of Object.entries(t))switch(a){case"mu:syncEvent":l=p;break;case"mu:apply":z(n,p);break;default:n[a]=p;break}const c=l?[]:void 0;for(let[a,p]of Object.entries(r)){if(c&&a in n){const f=E.getPropRefTolerant(p);f&&c.push([a,f])}switch(a){case"style":O(()=>{Object.assign(n.style,p())});break;case"classList":O(()=>{const f=p();for(const o of Object.entries(f))n.classList.toggle(...o)});break;default:O(()=>{n[a]=p()});break}}if(l&&c?.length)for(const a of l.matchAll(/\S+/g))n.addEventListener(a[0],()=>{for(const[p,f]of c)f.current=n[p]});return n}function se(e){const t=e();if(t instanceof Node)return t;let r=document.createTextNode("");return O(()=>{const s=document.createTextNode(String(e()??""));r.replaceWith(s),r=s}),r}var m=class{static id=0;startMarker=document.createTextNode("");endMarker=document.createTextNode("");constructor(...e){document.createDocumentFragment().append(this.startMarker,...e,this.endMarker)}removeAsFragment(){if(this.startMarker.parentNode instanceof DocumentFragment)return this.startMarker.parentNode;const e=[];for(let r=this.startMarker;;r=r?.nextSibling){if(r==null)throw Error("End marker not found as subsequent document sibling as start marker");if(e.push(r),Object.is(r,this.endMarker))break}const t=document.createDocumentFragment();return t.append(...e),t}emptyAsFragment(){const e=[];for(let r=this.startMarker.nextSibling;;r=r?.nextSibling){if(r==null)throw Error("End marker not found as subsequent document sibling as start marker");if(Object.is(r,this.endMarker))break;e.push(r)}const t=document.createDocumentFragment();return t.append(...e),t}replaceWith(...e){this.emptyAsFragment(),this.append(...e)}append(...e){const t=document.createDocumentFragment();if(t.append(...e),!this.endMarker.parentNode)throw Error("End marker of ElementSpan has no parent");this.endMarker.parentNode.insertBefore(t,this.endMarker)}};function oe(e){return Object.freeze({name:e})}var T=Object.freeze({errorBoundary:oe("error boundary")}),v;function ie(e,t){v={type:e,value:t,parent:v}}function ae(e){if(!v)throw Error("No active scope to exit.");if(!Object.is(e,v?.type))throw Error(`Tried to exit scope: ${e.name} instead of ${v.type.name}`);v=v?.parent}function ce(e,t){return Object.is(e.type,t)}function R(e){for(let t=v;t;t=t.parent)if(ce(t,e))return t.value}function B(e){return e!=null&&typeof e=="object"&&"node"in e&&e.node instanceof Node}var P={suppressUntrackedWarning:!0};function le(e,t){const r=new m,s=[],n=R(T.errorBoundary);return w(l=>{for(let c=s.length;c<e.length;c++){const a={container:new m};s.push(a),w(p=>{a.cleanup?.();const f=e[c];let o;if(n)try{o=f!==void 0?t(f,c,e):document.createTextNode("")}catch(i){n(i)}else o=f!==void 0?t(f,c,e):document.createTextNode("");B(o)?(a.container.replaceWith(o.node),a.cleanup=o.cleanup):o!=null&&(a.container.replaceWith(o),a.cleanup=void 0)},P),r.append(a.container.removeAsFragment())}for(;s.length>e.length;){const{cleanup:c,container:a}=s.pop();c?.(),a.removeAsFragment()}},P),r.removeAsFragment()}function pe(e,t){const r=new m,s=[],n=new WeakMap,l=R(T.errorBoundary);return w(()=>{for(let c=s.length;c<e.length;c++){const a=new m;s.push(a),w(p=>{a.emptyAsFragment();const f=e[c];if(f==null)return;if(typeof f!="object")throw Error("Elements must be object in ForEachPersist");let o=n.get(f);if(o==null){p&&(p.active=!1);try{const i=t(f);o=i instanceof HTMLElement?i:new m(i),n.set(f,o)}catch(i){if(l)l(i);else throw i}finally{p&&(p.active=!0)}}o instanceof HTMLElement?a.replaceWith(o):o!=null&&a.replaceWith(o.removeAsFragment())},P),r.append(a.removeAsFragment())}for(;s.length>e.length;)s.pop().removeAsFragment()},P),r.removeAsFragment()}function G(e){let t=!1,r;function s(){return t?r:(t=!0,r=e())}return s}var fe={suppressUntrackedWarning:!0};function ue(...e){const t=[],r=R(T.errorBoundary);let s=!1;for(const l of e)if("conditionGetter"in l)t.push({nodeGetter:G(l.nodeGetter),conditionGetter:l.conditionGetter});else{t.push({nodeGetter:G(l.nodeGetter)}),s=!0;break}if(!s){const l=document.createTextNode("");t.push({nodeGetter:()=>l})}let n=document.createTextNode("");return w(()=>{for(const{nodeGetter:c,conditionGetter:a}of t)if(!a||a()){let p=function(){const f=c();n.replaceWith(f),n=f};var l=p;if(r)try{p()}catch(f){r(f)}else p();break}},fe),n}function he(e){return document.createTextNode(String(e))}function de(e,t=document.createTextNode(""),r=he){const s=new m(t);return e.then(n=>s.replaceWith(n)),e.catch(n=>s.replaceWith(typeof r=="function"?r(n):r)),s.removeAsFragment()}function ye(e,t){const r=new m;function s(n){r.replaceWith(t(n))}try{ie(T.errorBoundary,s),r.append(e())}catch(n){s(n)}finally{ae(T.errorBoundary)}return r.removeAsFragment()}function be(e){const t=new m,r=R(T.errorBoundary);let s;return w(()=>{s?.(),s=void 0;let n;if(r)try{n=e()}catch(l){r(l)}else n=e();B(n)?(t.replaceWith(n.node),s=n.cleanup):n!=null&&t.replaceWith(n)}),t.removeAsFragment()}var I=new WeakMap;function ge(...e){if(e.some(n=>"pattern"in n&&n.pattern instanceof RegExp&&n.pattern.global))throw Error("Global-flagged route patterns not supported");const t=new m;let r;function s(n){const{hash:l}=new URL(n);for(const c of e){let a,p=!1;if("pattern"in c?typeof c.pattern=="string"?p=l===c.pattern:p=!!(a=c.pattern.exec(l)??void 0):p=!0,p){r?.removeAsFragment(),r=void 0;const{element:f}=c,o=typeof f=="function"?f(a):f;if(o instanceof DocumentFragment){let i=I.get(o);i||I.set(o,i=new m(o)),r=i,t.replaceWith(i.removeAsFragment())}else r=void 0,t.replaceWith(o);c.suppressScroll||window.scrollTo(0,0);return}}t.emptyAsFragment()}return window.addEventListener("hashchange",n=>s(n.newURL)),s(location.href),t.removeAsFragment()}var U="data-mu-style",me=String(Math.random()*1e6|0),ke=0;function we(e){const t=new CSSStyleSheet,r=me+"-"+ ++ke;for(const[s,n]of Object.entries(e)){const l=`[${U}="${r}"]`,c=`${l}:is(${s}), ${l} :is(${s}) {}`;t.insertRule(c,0);const a=t.cssRules.item(0);Object.assign(a.style,n)}return document.adoptedStyleSheets.push(t),{$muType:"attribute",name:U,value:r}}var ve="0.19.1";export{L as DependencyList,ye as ErrorBoundary,le as ForEach,pe as ForEachPersist,de as PromiseLoader,W as PropReference,ge as Router,be as Swapper,$ as Tracker,se as child,ue as choose,g as createOrRetrievePropRef,E as defaultTracker,w as effect,ne as element,x as isTracked,we as makeLocalStyle,_ as track,ve as version};
