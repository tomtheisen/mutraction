"use strict";var A=Symbol("RecordMutation"),F=Symbol("TrackerOf"),G=Symbol("ProxyOf"),D=Symbol("RecordDependency"),te=Symbol("GetOriginal"),H=Symbol("AccessPath"),P=Symbol("items");function Je(e){return{get(t,n,r){if(!(t instanceof Set))throw Error("Expected Set target in proxy.");const o=x(t,P);switch(n){case F:return e;case te:return t;case"size":return e[D](o),t.size;case"has":case"entries":case"keys":case"values":case"forEach":case Symbol.iterator:return function(){return e[D](o),t[n](...arguments)};case"add":return function(a){if(a=z(a,e)??a,B(a,L(t),"\u2203"),t.has(a))return;const f=t.add(a);return e[A]({type:"setadd",name:P,target:t,newValue:a}),f};case"delete":return function(a){if(a=z(a,e)??a,!t.has(a))return;const f=t.delete(a);return e[A]({type:"setdelete",name:P,target:t,oldValue:a}),f};case"clear":return function(){if(t.size===0)return;const a=Array.from(t.values());t.clear(),e[A]({type:"setclear",name:P,target:t,oldValues:a})};default:return Reflect.get(t,n,r)}}}}function Ke(e){return{get(t,n,r){if(!(t instanceof Map))throw Error("Expected Map target in proxy.");const o=x(t,P);switch(n){case F:return e;case te:return t;case"size":return e[D](o),t.size;case"has":case"keys":case"values":case"entries":case Symbol.iterator:return function(){return e[D](o),t[n](...arguments)};case"get":return function(a){e[D](o);const f=t.get(a);return typeof f=="object"&&f&&W(f)&&B(f,L(t),`get(${a})`),f};case"set":return function(a,f){Se(a);const p=t.has(a),h=p&&t.get(a),i=z(f,e);i&&B(i,L(t),`get(${a})`),t.set(a,f=i??f);const s=p?{target:t,name:P,type:"mapchange",key:a,newValue:f,oldValue:h}:{target:t,name:P,type:"mapcreate",key:a,newValue:f};return e[A](s),r};case"delete":return function(a){const f=t.get(a);if(!t.delete(a))return!1;const p={target:t,name:P,type:"mapdelete",key:a,oldValue:f};return e[A](p),!0};case"clear":return function(){const a=Array.from(t.entries());t.clear();const f={target:t,name:P,type:"mapclear",oldEntries:a};e[A](f)};default:return Reflect.get(t,n,r)}}}}function Se(e){if(e&&typeof e=="object"&&!Object.isFrozen(e))throw Error("In order to apply tracking proxy, Map keys must be immutable or frozen.")}var Qe=["copyWithin","fill","pop","push","reverse","shift","sort","splice","unshift"];function _e(e){return typeof e=="string"?Ee(e):typeof e=="number"&&(e&2147483647)===e}function Ee(e){return typeof e!="string"||!/^\d{1,10}$/.test(e)?!1:parseInt(e,10)<2147483647}function Xe(e){return Object.prototype.toString.call(e)==="[object Arguments]"}function Ye(e,t){Object.defineProperty(e,G,{enumerable:!1,writable:!0,configurable:!1,value:t})}function ne(e){return e[G]}var Te=new Set([RegExp,Promise]);"window"in globalThis&&Te.add(globalThis.window.constructor);function J(e){return!(e==null||typeof e!="object"||W(e)||!Object.isExtensible(e)||Te.has(e.constructor))}function z(e,t){if(typeof e!="object"||!e)return;if(W(e))return e;const n=ne(e);if(n){if(n[F]!==t)throw Error("Object cannot be tracked by multiple tracker instances");return n}if(J(e))return t.track(e)}function L(e){return e[H]}function B(e,t,n){const r=t?t+"."+String(n):String(n);Object.assign(e,{[H]:r})}function Ze(e,t){if(!J(e))throw Error("This object type cannot be proxied");if(e instanceof Set)return Je(t);if(e instanceof Map)return Ke(t);function n(i,s,l){if(s===F)return t;if(s===te)return i;if(s===H)return i[s];t[D](x(i,s));let d=Reflect.get(i,s,l);d&&typeof d=="object"&&S&&B(d,L(i),s);const y=z(d,t);if(y)d=i[s]=y;else if(typeof d=="function"&&t.options.autoTransactionalize&&s!=="constructor"){let v=function(){const M=t.startTransaction(T.name??"auto");try{return T.apply(l,arguments)}finally{M.operations.length>0?t.commit(M):t.rollback(M)}};var b=v;const T=d;return v}return d}function r(i,s,l){if(typeof s=="string"&&Qe.includes(s)){let y=function(){const v=t.startTransaction(String(s)),T=b.apply(l,arguments);return t.commit(v),T};var d=y;const b=i[s];return y}else return n(i,s,l)}let o=0;function c(i,s,l,d){if(s===H)return Reflect.set(i,H,l);l&&typeof l=="object"&&S&&B(l,L(i),s),l=z(l,t)??l;const y=s in i?{type:"change",target:i,name:s,oldValue:e[s],newValue:l}:{type:"create",target:i,name:s,newValue:l},b=o,v=Reflect.set(i,s,l,d);return v&&b==o++&&t[A](y),v}function a(i,s,l,d){if(!Array.isArray(i))throw Error("This object used to be an array.  Expected an array.");if(s==="length"){_e(l)||(i.length=l);const y=i.length,b=parseInt(l,10);if(b<y){const v=Object.freeze(i.slice(b,y)),T={type:"arrayshorten",target:i,name:s,oldLength:y,newLength:b,removed:v},M=Reflect.set(i,s,l,d);return t[A](T),++o,M}}if(Ee(s)){const y=parseInt(s,10);if(y>=i.length){const b={type:"arrayextend",target:i,name:s,oldLength:i.length,newIndex:y,newValue:l},v=Reflect.set(i,s,l,d);return t[A](b),++o,v}}return c(i,s,l,d)}function f(i,s){const l={type:"delete",target:i,name:s,oldValue:e[s]},d=Reflect.deleteProperty(i,s);return d&&t[A](l),d}let p=c,h=n;if(Array.isArray(e)&&(p=a,t.options.trackHistory&&(h=r)),Xe(e))throw Error("Tracking of exotic arguments objects not supported");return{get:h,set:p,deleteProperty:f}}function W(e){return typeof e=="object"&&!!e[F]}var et=class{get sizeBound(){return this.#e}#e=0;get generation(){return this.#t}#t=0;items=new Map;registry=new FinalizationRegistry(e=>{--this.#e,this.items.delete(e),++this.#t});add(e){this.registry.register(e,this.#e),this.items.set(this.#e++,new WeakRef(e)),++this.#t}*[Symbol.iterator](){for(const e of this.items.values()){const t=e.deref();t&&(yield t)}}},re=new et;function tt(){if(!re)throw Error("Only allowed in debug mode");return re}var Ae=class{object;prop;#e=new Set;#t=!1;get subscribers(){return this.#e}constructor(e,t){!W(e)&&e[G]&&(e=e[G]),this.object=e,this.prop=t,S&&re.add(this)}subscribe(e){return this.#e.add(e),{dispose:()=>this.#e.delete(e)}}notifySubscribers(){this.#t&&console.warn(`Re-entrant property subscription for '${String(this.prop)}'`);const e=Array.from(this.#e);this.#t=!0;for(const t of e)t.notifySubscribers(this);this.#t=!1}get current(){return this.object[this.prop]}set current(e){this.object[this.prop]=e}},Pe=new WeakMap;function x(e,t){let n=Pe.get(e);n||Pe.set(e,n=new Map);let r=n.get(t);return r||n.set(t,r=new Ae(e,t)),r}var nt=class{#e=new Map;#t;#n=!1;#r=new Set;active=!0;constructor(e){this.#t=e}get trackedProperties(){return Array.from(this.#e.keys())}addDependency(e){if(this.active&&!this.#n){if(this.#e.has(e))return;const t=e.subscribe(this);this.#e.set(e,t)}}subscribe(e){return this.#r.add(e),{dispose:()=>this.#r.delete(e)}}notifySubscribers(e){const t=Array.from(this.#r);for(const n of t)n(e)}endDependencyTrack(){this.#t.endDependencyTrack(this)}trackAllChanges(){if(this.#n)return;this.untrackAll();const e=x(this.#t,"history");this.addDependency(e),this.#n=!0}untrackAll(){for(const e of this.#e.values())e.dispose();this.#e.clear()}};function rt({operations:e}){for(let t=0;t<e.length;){const n=e[t];if(n.type==="transaction")e.splice(t,1,...n.operations);else if(n.type==="change"&&Object.is(n.oldValue,n.newValue))e.splice(t,1);else if(t>0){const r=e[t-1];if(r.type==="transaction")throw Error("Internal mutraction error.  Found internal transaction on look-back during packTransaction.");r.target!==n.target||r.name!==n.name?++t:r.type==="create"&&n.type==="change"?e.splice(--t,2,{...r,newValue:n.newValue}):r.type==="create"&&n.type==="delete"?e.splice(--t,2):r.type==="change"&&n.type==="change"?e.splice(--t,2,{...r,newValue:n.newValue}):r.type==="change"&&n.type==="delete"?e.splice(--t,2,{...n,oldValue:r.oldValue}):r.type==="delete"&&n.type==="create"?e.splice(--t,2,{...n,...r,type:"change"}):r.type==="setadd"&&n.type==="setdelete"&&Object.is(r.newValue,n.oldValue)||r.type==="setdelete"&&n.type==="setadd"&&Object.is(r.oldValue,n.newValue)?e.splice(--t,2):r.type==="mapcreate"&&n.type==="mapchange"&&r.key===n.key?e.splice(--t,2,{...r,newValue:n.newValue}):r.type==="mapcreate"&&n.type==="mapdelete"&&r.key===n.key?e.splice(--t,2):r.type==="mapchange"&&n.type==="mapchange"&&r.key===n.key?e.splice(--t,2,{...n,newValue:n.newValue}):r.type==="mapchange"&&n.type==="mapdelete"&&r.key===n.key?e.splice(--t,2,{...n,oldValue:r.oldValue}):r.type==="mapdelete"&&n.type==="mapcreate"&&r.key===n.key?e.splice(--t,2,{...n,...r,type:"mapchange"}):++t}else++t}}var Ce={trackHistory:!0,autoTransactionalize:!0,compactOnCommit:!0},Re=class{#e;#t;#n=[];#r=!1;#s=[];options=Ce;#o;constructor(e={}){this.setOptions(e)}setOptions(e={}){if(this.#r)throw Error("Cannot change options for a tracker that has already started tracking");e.trackHistory===!1&&(e.compactOnCommit=!1,e.autoTransactionalize??=!1);const t={...Ce,...e};if(t.compactOnCommit&&!t.trackHistory)throw Error("Option compactOnCommit requires option trackHistory");t.trackHistory?this.#t=[]:this.#t=void 0,this.options=Object.freeze(t)}track(e){if(W(e))throw Error("Object already tracked");this.#r=!0,ot(e,this);const t=new Proxy(e,Ze(e,this));return Ye(e,t),t}trackAsReadonlyDeep(e){return this.track(e)}#a(){if(!this.options.trackHistory)throw Error("History tracking disabled.")}get history(){if(this.#a(),this.#s[0]?.trackAllChanges(),this.#o??=x(this,"history"),!this.#t)throw Error("History tracking enabled, but no root transaction. Probably mutraction internal error.");return this.#t}startTransaction(e){return this.#e={type:"transaction",parent:this.#e,operations:[],dependencies:new Set},e&&(this.#e.transactionName=e),this.#e}commit(e){if(!this.#e)throw Error("Attempted to commit transaction when none were open.");if(e&&e!==this.#e)throw Error("Attempted to commit wrong transaction. Transactions must be resolved in stack order.");if(this.options.compactOnCommit&&rt(this.#e),this.#e.parent)this.#e.parent.operations.push(this.#e),this.#e.dependencies.forEach(t=>this.#e.parent.dependencies.add(t)),this.#e=this.#e.parent;else{this.#t?.push(this.#e);const t=new Set;for(const n of this.#e.dependencies)for(const r of n.subscribers)t.add(r);for(const n of t)n.notifySubscribers();this.#e=void 0}this.#e==null&&this.#o?.notifySubscribers()}rollback(e){if(e&&e!==this.#e)throw Error("Attempted to commit wrong transaction. Transactions must be resolved in stack order.");if(this.#e){for(;this.#e.operations.length;)this.undo();this.#e=this.#e.parent}else for(;this.#t?.length;)this.undo()}undo(){this.#a();const e=(this.#e?.operations??this.#t).pop();e&&(this.#l(e),this.#n.unshift(e),this.#e==null&&this.#o?.notifySubscribers())}#l(e){if(e.type==="transaction")for(let t=e.operations.length;t-- >0;)this.#l(e.operations[t]);else{const t=e.target;switch(e.type){case"change":case"delete":t[e.name]=e.oldValue;break;case"create":delete t[e.name];break;case"arrayextend":t.length=e.oldLength;break;case"arrayshorten":t.push(...e.removed);break;case"setadd":t.delete(e.newValue);break;case"setdelete":t.add(e.oldValue);break;case"setclear":e.oldValues.forEach(t.add.bind(t));break;case"mapcreate":t.delete(e.key);break;case"mapchange":case"mapdelete":t.set(e.key,e.oldValue);break;case"mapclear":e.oldEntries.forEach(([n,r])=>t.set(n,r));break;default:}this.#e||(x(e.target,e.name).notifySubscribers(),(e.type==="arrayextend"||e.type==="arrayshorten")&&x(e.target,"length").notifySubscribers())}}redo(){this.#a();const e=this.#n.shift();e&&(this.#f(e),(this.#e?.operations??this.#t).push(e),this.#e==null&&this.#o?.notifySubscribers())}#f(e){if(e.type==="transaction")for(const t of e.operations)this.#f(t);else{const t=e.target;switch(e.type){case"change":case"create":t[e.name]=e.newValue;break;case"delete":delete t[e.name];break;case"arrayextend":t[e.newIndex]=e.newValue;break;case"arrayshorten":t.length=e.newLength;break;case"setadd":t.add(e.newValue);break;case"setdelete":t.delete(e.oldValue);break;case"setclear":t.clear();break;case"mapcreate":case"mapchange":t.set(e.key,e.newValue);break;case"mapdelete":t.delete(e.key);break;case"mapclear":t.clear();break;default:}this.#e||(x(e.target,e.name).notifySubscribers(),(e.type==="arrayextend"||e.type==="arrayshorten")&&x(e.target,"length").notifySubscribers())}}clearRedos(){this.#n.length=0}clearHistory(){this.#a(),this.#e=void 0,this.#t.length=0,this.clearRedos()}[A](e){this.options.trackHistory&&(S&&(e.targetPath=L(e.target)),(this.#e?.operations??this.#t).push(Object.freeze(e))),this.clearRedos(),this.#e?(this.#e.dependencies.add(x(e.target,e.name)),(e.type==="arrayextend"||e.type==="arrayshorten")&&this.#e.dependencies.add(x(e.target,"length"))):(x(e.target,e.name).notifySubscribers(),(e.type==="arrayextend"||e.type==="arrayshorten")&&x(e.target,"length").notifySubscribers(),this.#o?.notifySubscribers())}ignoreUpdates(e){const t=this.startDependencyTrack();t.active=!1,e(),t.endDependencyTrack()}startDependencyTrack(){const e=new nt(this);return this.#s.unshift(e),e}endDependencyTrack(e){if(this.#s[0]!==e)throw Error("Specified dependency list is not top of stack");return this.#s.shift(),e}[D](e){this.#c?this.#i=e:this.#s[0]?.addDependency(e)}#c=!1;#i=void 0;getPropRef(e){const t=this.getPropRefTolerant(e);if(!t)throw Error("No tracked properties.  Prop ref detection requires a tracked object.");return t}getPropRefTolerant(e){if(this.#c)throw Error("Cannot be called re-entrantly.");this.#c=!0,this.#i=void 0;try{const t=e();if(!this.#i)return;const n=this.#i.current;return Object.is(t,n)||console.error("The last operation of the callback must be a property get.\n`(foo || bar).quux` is allowed, but `foo.bar + 1` is not"),this.#i}finally{this.#c=!1}}},C=new Re;function st(e){return C.track(e)}function ot(e,t){if(e instanceof Set){const n=Array.from(e);for(const r of n){const o=ne(r);o?(e.delete(r),e.add(o)):J(r)&&(e.delete(r),e.add(t.track(r)))}}else if(e instanceof Map){const n=Array.from(e);for(const[r,o]of n){Se(r);const c=ne(o);c?e.set(r,c):J(o)&&e.set(r,t.track(o))}}}var se="mu:debugMode",it=250,at=10,S="sessionStorage"in globalThis&&!!sessionStorage.getItem(se);if("sessionStorage"in globalThis){let e=function(){sessionStorage.setItem(se,"true"),location.reload()},t=function(){sessionStorage.removeItem(se),location.reload()};if(yt=e,gt=t,Object.assign(window,{[Symbol.for("mutraction.debug")]:e}),["localhost","127.0.0.1","[::1]"].includes(location.hostname)&&!S&&(console.info("[\xB5] Try the mutraction diagnostic tool.  This message is only shown from localhost, but the tool is always available."),console.info("\xBB window[Symbol.for('mutraction.debug')]()")),S){let n=function(u){return Array.isArray(u)?`Array(${u.length})`:typeof u=="object"?"{ ... }":typeof u=="function"?u.name?`${u.name}() { ... }`:"() => { ... }":JSON.stringify(u)},r=function(u,w,...g){const m=document.createElement(u);return m.style.all="revert",Object.assign(m.style,w),m.append(...g),m},o=function(u){const w=Array.from(u.childNodes).filter(g=>g instanceof Text).flatMap(g=>je(g)).filter(Boolean).map(g=>g);return(je(u)??[]).concat(...w)},c=function(u){const w=L(u.object),g=w?w+"."+String(u.prop):String(u.prop),m=u.current,k=n(m),O=!m||typeof m!="object"&&typeof m!="function",V=r("span",O?{cursor:"pointer",textDecoration:"underline"}:{},k),I=u.subscribers.size,Ue=`(${I} ${I===1?"subscriber":"subscribers"})`,Ge=r("li",{},r("code",{},g),": ",V," ",Ue);return O&&V.addEventListener("click",()=>{const xe=prompt(`Update ${String(u.prop)}`,k);try{xe&&(u.current=JSON.parse(xe)),a()}catch{}}),Ge},a=function(){const u=[];for(const w of q)u.push(c(w));be.replaceChildren(...u)},f=function(){N.disabled=!0,N.textContent="\u2026",U.textContent="(choose)";let u,w="";function g(m){if(m.target instanceof HTMLElement){let k=m.target;for(;k&&(o(k)?.length??0)===0;)k=k.parentElement;k!=u&&(u&&(u.style.boxShadow=w),w=k?.style.boxShadow??"",k&&(k.style.boxShadow?k.style.boxShadow+=", inset #f0f4 0 99vmax":k.style.boxShadow+="inset #f0f4 0 99vmax"),u=k)}m.stopPropagation()}document.addEventListener("mousemove",g,{capture:!0}),document.addEventListener("click",m=>{if(m.stopPropagation(),m.preventDefault(),N.disabled=!1,N.textContent="\u{1F50D}",document.removeEventListener("mousemove",g,{capture:!0}),u){u.style.boxShadow=w,U.textContent=u.tagName.toLowerCase();const k=o(u),O=new Set(k.flatMap(I=>I.trackedProperties)),V=[];for(const I of O)V.push(c(I));ee.replaceChildren(...V)}else U.textContent="(none)",ee.replaceChildren()},{capture:!0,once:!0})},p=function(){const{x:u,y:w,width:g,height:m}=s.getBoundingClientRect(),k=Math.max(0,Math.min(window.innerHeight-m,w)),O=Math.max(0,Math.min(window.innerWidth-g,u));s.style.top=k+"px",s.style.left=O+"px"};ct=n,lt=r,ft=o,ut=c,pt=a,dt=f,ht=p;const h=[];let i=0;queueMicrotask(()=>{E(function(){C.history.length,i===0&&(i=setTimeout(function(){for(const g of h)g();i=0},it))})});const s=r("div",{position:"fixed",top:"50px",left:"50px",width:"30em",height:"20em",resize:"both",minHeight:"1.6em",minWidth:"15em",zIndex:"2147483647",background:"#eee",color:"#123",boxShadow:"#000 0em 0.5em 1em",border:"solid #345 0.4em",fontSize:"16px",display:"flex",flexDirection:"column",overflow:"auto"}),l=r("button",{marginRight:"1em"},"_");let d=!1;l.addEventListener("click",u=>{(d=!d)?(s.style.maxHeight="1.6em",s.style.maxWidth="15em"):(s.style.maxHeight="",s.style.maxWidth=""),p()});const y=r("button",{float:"right"},"\xD7");y.addEventListener("click",t);const b=r("div",{fontWeight:"bold",background:"#123",color:"#eee",padding:"0.1em 1em",cursor:"grab"},y,l,"\u03BC diagnostics"),v=r("div",{whiteSpace:"pre"}),T=r("span",{},"0"),M=r("details",{cursor:"pointer",marginBottom:"1em"},r("summary",{},r("strong",{},"Active effects: "),T),v);let pe=-1;h.push(()=>{let{activeEffects:u,generation:w}=vt();w!==pe&&(pe=w,v.innerText=[...u.entries()].map(g=>`${g[0]}\xD7${g[1]}`).join(`
`),T.innerText=String(Array.from(u.values()).reduce((g,m)=>g+m,0)))});const Y=r("button",{},"Undo"),Z=r("button",{},"Redo");queueMicrotask(()=>{const{trackHistory:u}=C.options;u||(Y.disabled=Z.disabled=!0)});const de=C.history,he=r("span",{},"0"),ye=r("ol",{}),ze=r("details",{cursor:"pointer",marginBottom:"1em"},r("summary",{},r("strong",{},"Recent history: "),he," total ",Y,Z),ye);Y.addEventListener("click",()=>C.undo()),Z.addEventListener("click",()=>C.redo()),h.push(()=>{he.innerText=String(de.length);const u=de.slice(-at).map(mt).map(w=>r("li",{},w));ye.replaceChildren(...u)});const ge=r("span",{},"0"),q=tt(),me=r("button",{},"\u21BB");me.addEventListener("click",a);const be=r("ol",{}),Be=r("details",{},r("summary",{cursor:"pointer"},r("strong",{},"Live PropRefs: "),ge," ",me),be);let we=-1;h.push(()=>{q.generation!==we&&(ge.replaceChildren(String(q.sizeBound)),a(),we=q.generation)});const N=r("button",{},"\u{1F50D}");N.addEventListener("click",f);const U=r("span",{},"(none)"),ee=r("ol",{}),qe=r("div",{padding:"1em",overflow:"auto"},N," ",r("strong",{},"Inspected node:")," ",U,ee,M,ze,Be);s.append(b,qe),document.body.append(s);let ke=0,ve=0;b.addEventListener("mousedown",u=>{const w=s.getBoundingClientRect();ke=u.x-w.x,ve=u.y-w.y,window.addEventListener("mousemove",m),document.body.addEventListener("mouseup",g,{once:!0}),u.preventDefault();function g(k){window.removeEventListener("mousemove",m)}function m(k){(k.buttons&1)>0?(s.style.left=k.x-ke+"px",s.style.top=k.y-ve+"px",p()):(window.removeEventListener("mousemove",m),window.removeEventListener("mouseup",g))}}),window.addEventListener("resize",p)}}var ct,lt,ft,ut,pt,dt,ht,yt,gt;function mt(e){switch(e.type){case"transaction":return`Transaction ${e.transactionName}`;case"create":return`Create property ${String(e.name)}: ${e.newValue}`;case"change":return`Modify property ${String(e.name)}: ${e.newValue}`;case"delete":return`Delete property ${String(e.name)}`;case"arrayextend":return`Extend array to [${e.newIndex}] = ${e.newValue}`;case"arrayshorten":return`Shorten array to ${e.newLength}`;case"setadd":return`Add to set: ${e.newValue}`;case"setdelete":return`Delete from set: ${e.oldValue}`;case"setclear":return"Clear set";case"mapcreate":return`Add new entry to map [${e.key}, ${e.newValue}]`;case"mapchange":return`Change entry in map [${e.key}, ${e.newValue}]`;case"mapdelete":return`Remove key from map ${e.key}`;case"mapclear":return"Clear map";default:}throw new Error("Function not implemented.")}var bt={dispose:()=>{},noop:!0},oe=0,j=new Map;function wt(e){const t=e.name||"(anonymous)",n=j.get(t);n?j.set(t,n+1):j.set(t,1),++oe}function kt(e){const t=e.name||"(anonymous)",n=j.get(t);!n||n<=1?j.delete(t):j.set(t,n-1),++oe}function vt(){return{activeEffects:j,generation:oe}}function E(e,t={}){const{tracker:n=C,suppressUntrackedWarning:r=!1}=t;let o=n.startDependencyTrack(),c;try{c=e(o)}finally{o.endDependencyTrack()}if(o.trackedProperties.length===0)return r||console.warn("effect() callback has no dependencies on any tracked properties.  It will not fire again."),bt;S&&wt(e);let a=o.subscribe(i),f=!1,p=!1;function h(){f&&console.error("Effect already disposed"),f=!0,o.untrackAll(),a.dispose(),!p&&S&&kt(e)}function i(s){typeof c=="function"&&c(),p=!0,h(),p=f=!1,o=n.startDependencyTrack(),c=e(o,s),o.endDependencyTrack(),a=o.subscribe(i)}return{dispose:h}}var ie=new WeakMap;function $(e,t){if(t.noop)return;const n=ie.get(e);n?n.push(t):ie.set(e,[t])}var ae=De.bind(null,Me);function Me(e){ie.get(e)?.forEach(n=>n.dispose()),e instanceof Element&&e.childNodes.forEach(Me)}var ce=!1,K=[];if(!("requestIdleCallback"in globalThis)){const e={didTimeout:!1,timeRemaining(){return 1e3}};Object.assign(globalThis,{requestIdleCallback(t){requestAnimationFrame(t.bind(null,e))}})}function Oe(e){let t=0,n=performance.now();for(;K.length;){const{task:r,data:o}=K.shift();if(r(o),(performance.now()-n)/++t*2>e.timeRemaining())break}K.length?window.requestIdleCallback(Oe):ce=!1}function De(e,t){K.push({task:e,data:t}),ce||(window.requestIdleCallback(Oe),ce=!0)}var Q={suppressUntrackedWarning:!0};function xt(e){return e!=null&&typeof e=="object"&&"$muType"in e&&typeof e.$muType=="string"}function Le(e,t){if(Array.isArray(t)){t.forEach(n=>Le(e,n));return}if(!xt(t))throw Error("Expected a node modifier for 'mu:apply', but got "+typeof t);switch(t.$muType){case"attribute":e.setAttribute(t.name,t.value);break;default:throw Error("Unknown node modifier type: "+t.$muType)}}var le=new WeakMap;function _(e,t){if(t.trackedProperties.length===0)return;let n=le.get(e);n||le.set(e,n=[]),n.push(t)}function je(e){return le.get(e)}var $e={class:"className"};function St(e,t,n,...r){const o=document.createElement(e);o.append(...r);let c;for(let[i,s]of Object.entries(t))switch(i=$e[i]??i,i){case"mu:syncEvent":c=s;break;case"mu:apply":Le(o,s);break;default:o[i]=s;break}const a=c?[]:void 0;for(let[i,s]of Object.entries(n)){if(i=$e[i]??i,a&&i in o){const l=C.getPropRefTolerant(s);l&&a.push([i,l])}switch(i){case"style":{let l=function(y){Object.assign(o.style,s()),S&&_(o,y)};var f=l;const d=E(l,Q);$(o,d);break}case"classList":{let l=function(y){const b=s();for(const[v,T]of Object.entries(b))o.classList.toggle(v,!!T);S&&_(o,y)};var p=l;const d=E(l,Q);$(o,d);break}default:{let l=function(y){o[i]=s(),S&&_(o,y)};var h=l;const d=E(l,Q);$(o,d);break}}}if(c&&a?.length)for(const i of c.matchAll(/\S+/g))o.addEventListener(i[0],()=>{for(const[s,l]of a)l.current=o[s]});return o}function Et(e){let t=document.createTextNode(""),n;return n=E(function(o){const c=e();if(c instanceof Node)o.untrackAll(),t=c;else{const a=document.createTextNode(String(c??""));n&&$(a,n),t.replaceWith(a),t=a,S&&_(t,o)}},Q),$(t,n),t}var R=class{static id=0;startMarker=document.createTextNode("");endMarker=document.createTextNode("");constructor(...e){document.createDocumentFragment().append(this.startMarker,...e,this.endMarker)}removeAsFragment(){const e=this.startMarker.parentNode;if(e instanceof DocumentFragment&&e.firstChild===this.startMarker&&e.lastChild===this.endMarker)return e;const t=[];for(let r=this.startMarker;;r=r?.nextSibling){if(r==null)throw Error("End marker not found as subsequent document sibling as start marker");if(t.push(r),Object.is(r,this.endMarker))break}const n=document.createDocumentFragment();return n.append(...t),n}empty(){let e=null;for(;(e=this.startMarker.nextSibling)!==this.endMarker;){if(e==null)throw Error("End marker not found as subsequent document sibling as start marker");ae(e),e.remove()}}replaceWith(...e){this.empty(),this.append(...e)}append(...e){const t=document.createDocumentFragment();if(t.append(...e),!this.endMarker.parentNode)throw Error("End marker of ElementSpan has no parent");this.endMarker.parentNode.insertBefore(t,this.endMarker)}registerCleanup(e){$(this.startMarker,e)}cleanup(){this.empty(),ae(this.startMarker)}};function Ne(e){return e!=null&&typeof e=="object"&&"node"in e&&e.node instanceof Node}function fe(e){const t=new R,n=E(function(o){t.empty();const c=e();if(Ne(c))return t.replaceWith(c.node),c.cleanup;if(c!=null){t.replaceWith(c);return}});return t.registerCleanup(n),t.removeAsFragment()}var X={suppressUntrackedWarning:!0};function Ie(e,t){if(typeof e=="function")return fe(()=>Ie(e(),t));const n=new R,r=[],o=e??[],c=E(function(f){for(let p=r.length;p<o.length;p++){const h={container:new R};r.push(h),h.subscription=E(function(s){h.container.empty();const l=o[p],d=l!==void 0?t(l,p,o):document.createTextNode("");return Ne(d)?(h.container.replaceWith(d.node),h.cleanup=d.cleanup):d!=null&&(h.container.replaceWith(d),h.cleanup=void 0),h.cleanup},X),n.append(h.container.removeAsFragment())}for(r.length>0&&o.length===0&&console.log("TODO optimize");r.length>o.length;){const p=r.pop();p.container.removeAsFragment(),De(We,p)}},X);return n.registerCleanup({dispose(){r.forEach(We)}}),n.registerCleanup(c),n.removeAsFragment()}function We({cleanup:e,container:t,subscription:n}){e?.(),n?.dispose(),t.cleanup()}function Ve(e,t){if(typeof e=="function")return fe(()=>Ve(e(),t));const n=new R,r=[],o=new WeakMap,c=e??[],a=E(function(h){for(let i=r.length;i<c.length;i++){const s=new R;r.push(s),E(function(d){s.empty();const y=c[i];if(y==null)return;if(typeof y!="object")throw Error("Elements must be object in ForEachPersist");let b=o.get(y);if(b==null){d&&(d.active=!1);try{const v=t(y);b=v instanceof HTMLElement?v:new R(v),o.set(y,b)}finally{d&&(d.active=!0)}}b instanceof HTMLElement?s.replaceWith(b):b!=null&&s.replaceWith(b.removeAsFragment())},X),n.append(s.removeAsFragment())}for(;r.length>c.length;)f(r.pop())},X);return n.registerCleanup({dispose(){r.forEach(f)}}),n.registerCleanup(a),n.removeAsFragment();function f(p){p.removeAsFragment(),p.cleanup()}}var Tt={suppressUntrackedWarning:!0};function At(){return document.createTextNode("")}function Pt(...e){let t,n,r=!1;function o(){r||c.dispose()}const c=E(function(){let f;for(const{nodeGetter:p,conditionGetter:h}of e)if(!h||h()){f=p;break}if(f??=At,f!==n){t&&(r=!0,ae(t),r=!1),n=f;const p=n();t?.replaceWith(p),$(p,{dispose:o}),t=p}},Tt);if(!t)throw Error("Logical error in choose() for mu:if.  No element assigned after first effect invocation.");return t}function Ct(e){return document.createTextNode(String(e))}function Rt(e,t=document.createTextNode(""),n=Ct){const r=new R(t);return e.then(o=>r.replaceWith(o)),e.catch(o=>r.replaceWith(typeof n=="function"?n(o):n)),r.removeAsFragment()}var Fe=new WeakMap;function Mt(...e){if(e.some(c=>"pattern"in c&&c.pattern instanceof RegExp&&c.pattern.global))throw Error("Global-flagged route patterns not supported");const t=new R;let n,r=!1;function o(c){const{hash:a}=new URL(c);for(const f of e){let p,h=!1;if("pattern"in f?typeof f.pattern=="string"?h=a===f.pattern:h=!!(p=f.pattern.exec(a)??void 0):h=!0,h){r?n?.cleanup():n?.removeAsFragment(),n=void 0;const{element:i}=f;r=typeof i=="function";const s=typeof i=="function"?i(p):i;if(s instanceof DocumentFragment){let l=Fe.get(s);l||Fe.set(s,l=new R(s)),n=l,t.replaceWith(l.removeAsFragment())}else n=void 0,t.replaceWith(s);f.suppressScroll||window.scrollTo(0,0);return}}t.empty()}return window.addEventListener("hashchange",c=>o(c.newURL)),o(location.href),t.removeAsFragment()}var He="data-mu-style",Ot=String(Math.random()*1e6|0),Dt=0;function Lt(e){const t=new CSSStyleSheet,n=Ot+"-"+ ++Dt;for(const[r,o]of Object.entries(e)){const c=`[${He}="${n}"]`,a=`${c}:is(${r}), ${c} :is(${r}) {}`;t.insertRule(a,0);const f=t.cssRules.item(0);Object.assign(f.style,o)}return document.adoptedStyleSheets.push(t),{$muType:"attribute",name:He,value:n}}function jt(e,t=10){return ue(e,t)}function ue(e,t){if(t<0)throw Error("Maximum depth exceeded.  Maybe there's a reference cycle?");if(typeof e!="object")return e;if(Array.isArray(e))return e.map(r=>ue(r,t-1));if(e.constructor&&e.constructor!==Object)throw Error("Can't clone objects with a prototype chain or instances of classes");return Object.fromEntries(Object.entries(e).map(([n,r])=>[n,ue(r,t-1)]))}var $t="0.24.0";export{Ie as ForEach,Ve as ForEachPersist,Rt as PromiseLoader,Ae as PropReference,Mt as Router,fe as Swapper,Re as Tracker,Et as child,Pt as choose,x as createOrRetrievePropRef,C as defaultTracker,E as effect,St as element,W as isTracked,Lt as makeLocalStyle,st as track,jt as untrackedClone,$t as version};
