"use strict";var E=Symbol("RecordMutation"),I=Symbol("TrackerOf"),J=Symbol("ProxyOf"),O=Symbol("RecordDependency"),Z=Symbol("GetOriginal"),V=Symbol("AccessPath"),D=Symbol("items");function We(e){return{get(t,n,r){if(!(t instanceof Set))throw Error("Expected Set target in proxy.");const s=S(t,D);switch(n){case I:return e;case Z:return t;case"size":return e[O](s),t.size;case"has":case"entries":case"keys":case"values":case"forEach":case Symbol.iterator:return function(){return e[O](s),t[n](...arguments)};case"add":return function(a){if(a=H(a,e)??a,z(a,C(t),"\u2203"),t.has(a))return;const f=t.add(a);return e[E]({type:"setadd",name:D,target:t,timestamp:new Date,newValue:a}),f};case"delete":return function(a){if(a=H(a,e)??a,!t.has(a))return;const f=t.delete(a);return e[E]({type:"setdelete",name:D,target:t,timestamp:new Date,oldValue:a}),f};case"clear":return function(){if(t.size===0)return;const a=Array.from(t.values());t.clear(),e[E]({type:"setclear",name:D,target:t,timestamp:new Date,oldValues:a})};default:return Reflect.get(t,n,r)}}}}function Ie(e){return{get(t,n,r){if(!(t instanceof Map))throw Error("Expected Map target in proxy.");const s=S(t,D);switch(n){case I:return e;case Z:return t;case"size":return e[O](s),t.size;case"has":case"keys":case"values":case"entries":case Symbol.iterator:return function(){return e[O](s),t[n](...arguments)};case"get":return function(a){e[O](s);const f=t.get(a);return typeof f=="object"&&f&&F(f)&&z(f,C(t),`get(${a})`),f};case"set":return function(a,f){ke(a);const u=t.has(a),y=u&&t.get(a),o=H(f,e);o&&z(o,C(t),`get(${a})`),t.set(a,f=o??f);const i=u?{target:t,name:D,timestamp:new Date,type:"mapchange",key:a,newValue:f,oldValue:y}:{target:t,name:D,timestamp:new Date,type:"mapcreate",key:a,newValue:f};return e[E](i),r};case"delete":return function(a){const f=t.get(a);if(!t.delete(a))return!1;const u={target:t,name:D,timestamp:new Date,type:"mapdelete",key:a,oldValue:f};return e[E](u),!0};case"clear":return function(){const a=Array.from(t.entries());t.clear();const f={target:t,name:D,timestamp:new Date,type:"mapclear",oldEntries:a};e[E](f)};default:return Reflect.get(t,n,r)}}}}function ke(e){if(e&&typeof e=="object"&&!Object.isFrozen(e))throw Error("In order to apply tracking proxy, Map keys must be immutable or frozen.")}var Ve=["copyWithin","fill","pop","push","reverse","shift","sort","splice","unshift"];function He(e){return typeof e=="string"?xe(e):typeof e=="number"&&(e&2147483647)===e}function xe(e){return typeof e!="string"||!/^\d{1,10}$/.test(e)?!1:parseInt(e,10)<2147483647}function ze(e){return Object.prototype.toString.call(e)==="[object Arguments]"}function Be(e,t){Object.defineProperty(e,J,{enumerable:!1,writable:!0,configurable:!1,value:t})}function ee(e){return e[J]}var Se=new Set([RegExp,Promise]);"window"in globalThis&&Se.add(globalThis.window.constructor);function K(e){return!(e==null||typeof e!="object"||F(e)||!Object.isExtensible(e)||Se.has(e.constructor))}function H(e,t){if(typeof e!="object"||!e)return;if(F(e))return e;const n=ee(e);if(n){if(n[I]!==t)throw Error("Object cannot be tracked by multiple tracker instances");return n}if(K(e))return t.track(e)}function C(e){return e[V]}function z(e,t,n){const r=t?t+"."+String(n):String(n);Object.assign(e,{[V]:r})}function Ge(e,t){if(!K(e))throw Error("This object type cannot be proxied");if(e instanceof Set)return We(t);if(e instanceof Map)return Ie(t);function n(o,i,l){if(i===I)return t;if(i===Z)return o;if(i===V)return o[i];t[O](S(o,i));let d=Reflect.get(o,i,l);d&&typeof d=="object"&&A&&z(d,C(o),i);const h=H(d,t);if(h)d=o[i]=h;else if(typeof d=="function"&&t.options.autoTransactionalize&&i!=="constructor"){let b=function(){const P=t.startTransaction(v.name??"auto");try{return v.apply(l,arguments)}finally{P.operations.length>0?t.commit(P):t.rollback(P)}};var m=b;const v=d;return b}return d}function r(o,i,l){if(typeof i=="string"&&Ve.includes(i)){let h=function(){const b=t.startTransaction(String(i)),v=m.apply(l,arguments);return t.commit(b),v};var d=h;const m=o[i];return h}else return n(o,i,l)}let s=0;function c(o,i,l,d){if(i===V)return Reflect.set(o,V,l);l&&typeof l=="object"&&A&&z(l,C(o),i),l=H(l,t)??l;const h=i in o?{type:"change",target:o,name:i,oldValue:e[i],newValue:l,timestamp:new Date}:{type:"create",target:o,name:i,newValue:l,timestamp:new Date},m=s,b=Reflect.set(o,i,l,d);return b&&m==s++&&t[E](h),b}function a(o,i,l,d){if(!Array.isArray(o))throw Error("This object used to be an array.  Expected an array.");if(i==="length"){He(l)||(o.length=l);const h=o.length,m=parseInt(l,10);if(m<h){const b=Object.freeze(o.slice(m,h)),v={type:"arrayshorten",target:o,name:i,oldLength:h,newLength:m,removed:b,timestamp:new Date},P=Reflect.set(o,i,l,d);return t[E](v),++s,P}}if(xe(i)){const h=parseInt(i,10);if(h>=o.length){const m={type:"arrayextend",target:o,name:i,oldLength:o.length,newIndex:h,newValue:l,timestamp:new Date},b=Reflect.set(o,i,l,d);return t[E](m),++s,b}}return c(o,i,l,d)}function f(o,i){const l={type:"delete",target:o,name:i,oldValue:e[i],timestamp:new Date},d=Reflect.deleteProperty(o,i);return d&&t[E](l),d}let u=c,y=n;if(Array.isArray(e)&&(u=a,t.options.trackHistory&&(y=r)),ze(e))throw Error("Tracking of exotic arguments objects not supported");return{get:y,set:u,deleteProperty:f}}function F(e){return typeof e=="object"&&!!e[I]}var Ue=class{get sizeBound(){return this.#e}#e=0;get generation(){return this.#t}#t=0;items=new Map;registry=new FinalizationRegistry(e=>{--this.#e,this.items.delete(e),++this.#t});add(e){this.registry.register(e,this.#e),this.items.set(this.#e++,new WeakRef(e)),++this.#t}*[Symbol.iterator](){for(const e of this.items.values()){const t=e.deref();t&&(yield t)}}},te=new Ue;function qe(){if(!te)throw Error("Only allowed in debug mode");return te}var ve=class{object;prop;#e=new Set;#t=!1;get subscribers(){return this.#e}constructor(e,t){!F(e)&&e[J]&&(e=e[J]),this.object=e,this.prop=t,te?.add(this)}subscribe(e){return this.#e.add(e),{dispose:()=>this.#e.delete(e)}}notifySubscribers(){this.#t&&console.warn(`Re-entrant property subscription for '${String(this.prop)}'`);const e=Array.from(this.#e);this.#t=!0;for(const t of e)t.notifySubscribers(this);this.#t=!1}get current(){return this.object[this.prop]}set current(e){this.object[this.prop]=e}},Ee=new WeakMap;function S(e,t){let n=Ee.get(e);n||Ee.set(e,n=new Map);let r=n.get(t);return r||n.set(t,r=new ve(e,t)),r}var Je=class{#e=new Map;#t;#n=!1;#r=new Set;active=!0;constructor(e){this.#t=e}get trackedProperties(){return Array.from(this.#e.keys())}addDependency(e){if(this.active&&!this.#n){if(this.#e.has(e))return;const t=e.subscribe(this);this.#e.set(e,t)}}subscribe(e){return this.#r.add(e),{dispose:()=>this.#r.delete(e)}}notifySubscribers(e){const t=Array.from(this.#r);for(const n of t)n(e)}endDependencyTrack(){this.#t.endDependencyTrack(this)}trackAllChanges(){if(this.#n)return;this.untrackAll();const e=S(this.#t,"history");this.addDependency(e),this.#n=!0}untrackAll(){for(const e of this.#e.values())e.dispose();this.#e.clear()}};function Ke({operations:e}){for(let t=0;t<e.length;){const n=e[t];if(n.type==="transaction")e.splice(t,1,...n.operations);else if(n.type==="change"&&Object.is(n.oldValue,n.newValue))e.splice(t,1);else if(t>0){const r=e[t-1];if(r.type==="transaction")throw Error("Internal mutraction error.  Found internal transaction on look-back during packTransaction.");r.target!==n.target||r.name!==n.name?++t:r.type==="create"&&n.type==="change"?e.splice(--t,2,{...r,newValue:n.newValue}):r.type==="create"&&n.type==="delete"?e.splice(--t,2):r.type==="change"&&n.type==="change"?e.splice(--t,2,{...r,newValue:n.newValue}):r.type==="change"&&n.type==="delete"?e.splice(--t,2,{...n,oldValue:r.oldValue}):r.type==="delete"&&n.type==="create"?e.splice(--t,2,{...n,...r,type:"change"}):r.type==="setadd"&&n.type==="setdelete"&&Object.is(r.newValue,n.oldValue)||r.type==="setdelete"&&n.type==="setadd"&&Object.is(r.oldValue,n.newValue)?e.splice(--t,2):r.type==="mapcreate"&&n.type==="mapchange"&&r.key===n.key?e.splice(--t,2,{...r,newValue:n.newValue}):r.type==="mapcreate"&&n.type==="mapdelete"&&r.key===n.key?e.splice(--t,2):r.type==="mapchange"&&n.type==="mapchange"&&r.key===n.key?e.splice(--t,2,{...n,newValue:n.newValue}):r.type==="mapchange"&&n.type==="mapdelete"&&r.key===n.key?e.splice(--t,2,{...n,oldValue:r.oldValue}):r.type==="mapdelete"&&n.type==="mapcreate"&&r.key===n.key?e.splice(--t,2,{...n,...r,type:"mapchange"}):++t}else++t}}var Ae={trackHistory:!0,autoTransactionalize:!0,compactOnCommit:!0},Te=class{#e;#t;#n=[];#r=!1;#s=[];options=Ae;#o;constructor(e={}){this.setOptions(e)}setOptions(e={}){if(this.#r)throw Error("Cannot change options for a tracker that has already started tracking");e.trackHistory===!1&&(e.compactOnCommit=!1,e.autoTransactionalize??=!1);const t={...Ae,...e};if(t.compactOnCommit&&!t.trackHistory)throw Error("Option compactOnCommit requires option trackHistory");t.trackHistory?this.#t=[]:this.#t=void 0,this.options=Object.freeze(t)}track(e){if(F(e))throw Error("Object already tracked");this.#r=!0,Qe(e,this);const t=new Proxy(e,Ge(e,this));return Be(e,t),t}trackAsReadonlyDeep(e){return this.track(e)}#a(){if(!this.options.trackHistory)throw Error("History tracking disabled.")}get history(){if(this.#a(),this.#s[0]?.trackAllChanges(),this.#o??=S(this,"history"),!this.#t)throw Error("History tracking enabled, but no root transaction. Probably mutraction internal error.");return this.#t}startTransaction(e){return this.#e={type:"transaction",parent:this.#e,operations:[],dependencies:new Set,timestamp:new Date},e&&(this.#e.transactionName=e),this.#e}commit(e){if(!this.#e)throw Error("Attempted to commit transaction when none were open.");if(e&&e!==this.#e)throw Error("Attempted to commit wrong transaction. Transactions must be resolved in stack order.");if(this.options.compactOnCommit&&Ke(this.#e),this.#e.parent)this.#e.parent.operations.push(this.#e),this.#e.dependencies.forEach(t=>this.#e.parent.dependencies.add(t)),this.#e=this.#e.parent;else{this.#t?.push(this.#e);const t=new Set;for(const n of this.#e.dependencies)for(const r of n.subscribers)t.add(r);for(const n of t)n.notifySubscribers();this.#e=void 0}this.#e==null&&this.#o?.notifySubscribers()}rollback(e){if(e&&e!==this.#e)throw Error("Attempted to commit wrong transaction. Transactions must be resolved in stack order.");if(this.#e){for(;this.#e.operations.length;)this.undo();this.#e=this.#e.parent}else for(;this.#t?.length;)this.undo()}undo(){this.#a();const e=(this.#e?.operations??this.#t).pop();e&&(this.#l(e),this.#n.unshift(e),this.#e==null&&this.#o?.notifySubscribers())}#l(e){if(e.type==="transaction")for(let t=e.operations.length;t-- >0;)this.#l(e.operations[t]);else{const t=e.target;switch(e.type){case"change":case"delete":t[e.name]=e.oldValue;break;case"create":delete t[e.name];break;case"arrayextend":t.length=e.oldLength;break;case"arrayshorten":t.push(...e.removed);break;case"setadd":t.delete(e.newValue);break;case"setdelete":t.add(e.oldValue);break;case"setclear":e.oldValues.forEach(t.add.bind(t));break;case"mapcreate":t.delete(e.key);break;case"mapchange":case"mapdelete":t.set(e.key,e.oldValue);break;case"mapclear":e.oldEntries.forEach(([n,r])=>t.set(n,r));break;default:}this.#e||(S(e.target,e.name).notifySubscribers(),(e.type==="arrayextend"||e.type==="arrayshorten")&&S(e.target,"length").notifySubscribers())}}redo(){this.#a();const e=this.#n.shift();e&&(this.#f(e),(this.#e?.operations??this.#t).push(e),this.#e==null&&this.#o?.notifySubscribers())}#f(e){if(e.type==="transaction")for(const t of e.operations)this.#f(t);else{const t=e.target;switch(e.type){case"change":case"create":t[e.name]=e.newValue;break;case"delete":delete t[e.name];break;case"arrayextend":t[e.newIndex]=e.newValue;break;case"arrayshorten":t.length=e.newLength;break;case"setadd":t.add(e.newValue);break;case"setdelete":t.delete(e.oldValue);break;case"setclear":t.clear();break;case"mapcreate":case"mapchange":t.set(e.key,e.newValue);break;case"mapdelete":t.delete(e.key);break;case"mapclear":t.clear();break;default:}this.#e||(S(e.target,e.name).notifySubscribers(),(e.type==="arrayextend"||e.type==="arrayshorten")&&S(e.target,"length").notifySubscribers())}}clearRedos(){this.#n.length=0}clearHistory(){this.#a(),this.#e=void 0,this.#t.length=0,this.clearRedos()}[E](e){this.options.trackHistory&&(A&&(e.targetPath=C(e.target)),(this.#e?.operations??this.#t).push(Object.freeze(e))),this.clearRedos(),this.#e?(this.#e.dependencies.add(S(e.target,e.name)),(e.type==="arrayextend"||e.type==="arrayshorten")&&this.#e.dependencies.add(S(e.target,"length"))):(S(e.target,e.name).notifySubscribers(),(e.type==="arrayextend"||e.type==="arrayshorten")&&S(e.target,"length").notifySubscribers(),this.#o?.notifySubscribers())}ignoreUpdates(e){const t=this.startDependencyTrack();t.active=!1,e(),t.endDependencyTrack()}startDependencyTrack(){const e=new Je(this);return this.#s.unshift(e),e}endDependencyTrack(e){if(this.#s[0]!==e)throw Error("Specified dependency list is not top of stack");return this.#s.shift(),e}[O](e){this.#c?this.#i=e:this.#s[0]?.addDependency(e)}#c=!1;#i=void 0;getPropRef(e){const t=this.getPropRefTolerant(e);if(!t)throw Error("No tracked properties.  Prop ref detection requires a tracked object.");return t}getPropRefTolerant(e){if(this.#c)throw Error("Cannot be called re-entrantly.");this.#c=!0,this.#i=void 0;try{const t=e();if(!this.#i)return;const n=this.#i.current;return Object.is(t,n)||console.error("The last operation of the callback must be a property get.\n`(foo || bar).quux` is allowed, but `foo.bar + 1` is not"),this.#i}finally{this.#c=!1}}},M=new Te;function _e(e){return M.track(e)}function Qe(e,t){if(e instanceof Set){const n=Array.from(e);for(const r of n){const s=ee(r);s?(e.delete(r),e.add(s)):K(r)&&(e.delete(r),e.add(t.track(r)))}}else if(e instanceof Map){const n=Array.from(e);for(const[r,s]of n){ke(r);const c=ee(s);c?e.set(r,c):K(s)&&e.set(r,t.track(s))}}}var ne="mu:debugMode",re=250,A="sessionStorage"in globalThis&&!!sessionStorage.getItem(ne);if("sessionStorage"in globalThis){let e=function(){sessionStorage.setItem(ne,"true"),location.reload()},t=function(){sessionStorage.removeItem(ne),location.reload()};if(rt=e,st=t,Object.assign(window,{[Symbol.for("mutraction.debug")]:e}),["localhost","127.0.0.1","[::1]"].includes(location.hostname)&&!A&&(console.info("[\xB5] Try the mutraction diagnostic tool.  This message is only shown from localhost, but the tool is always available."),console.info("\xBB window[Symbol.for('mutraction.debug')]()")),A){let n=function(p){return Array.isArray(p)?`Array(${p.length})`:typeof p=="object"?"{ ... }":typeof p=="function"?p.name?`${p.name}() { ... }`:"() => { ... }":JSON.stringify(p)},r=function(p,w,...k){const g=document.createElement(p);return g.style.all="revert",Object.assign(g.style,w),g.append(...k),g},s=function(p){const w=Array.from(p.childNodes).filter(k=>k instanceof Text).flatMap(k=>De(k)).filter(Boolean).map(k=>k);return(De(p)??[]).concat(...w)},c=function(p){const w=C(p.object),k=w?w+"."+String(p.prop):String(p.prop),g=p.current,x=n(g),q=!g||typeof g!="object"&&typeof g!="function",W=r("span",q?{cursor:"pointer",textDecoration:"underline"}:{},x),$=p.subscribers.size,$e=`(${$} ${$===1?"subscriber":"subscribers"})`,Fe=r("li",{},r("code",{},k),": ",W," ",$e);return q&&W.addEventListener("click",()=>{const we=prompt(`Update ${String(p.prop)}`,x);try{we&&(p.current=JSON.parse(we)),a()}catch{}}),Fe},a=function(){const p=[];for(const w of G)p.push(c(w));ye.replaceChildren(...p)},f=function(){N.disabled=!0,N.textContent="\u2026",U.textContent="(choose)";let p,w="";function k(g){if(g.target instanceof HTMLElement){let x=g.target;for(;x&&(s(x)?.length??0)===0;)x=x.parentElement;x!=p&&(p&&(p.style.boxShadow=w),w=x?.style.boxShadow??"",x&&(x.style.boxShadow?x.style.boxShadow+=", inset #f0f4 0 99vmax":x.style.boxShadow+="inset #f0f4 0 99vmax"),p=x)}g.stopPropagation()}document.addEventListener("mousemove",k,{capture:!0}),document.addEventListener("click",g=>{if(g.stopPropagation(),g.preventDefault(),N.disabled=!1,N.textContent="\u{1F50D}",document.removeEventListener("mousemove",k,{capture:!0}),p){p.style.boxShadow=w,U.textContent=p.tagName.toLowerCase();const x=s(p),q=new Set(x.flatMap($=>$.trackedProperties)),W=[];for(const $ of q)W.push(c($));Y.replaceChildren(...W)}else U.textContent="(none)",Y.replaceChildren()},{capture:!0,once:!0})};Xe=n,Ye=r,Ze=s,et=c,tt=a,nt=f;const u=r("div",{position:"fixed",top:"50px",left:"50px",width:"30em",height:"20em",resize:"both",minHeight:"1.6em",minWidth:"15em",zIndex:"2147483647",background:"#eee",color:"#123",boxShadow:"#000 0em 0.5em 1em",border:"solid #345 0.4em",fontSize:"16px",display:"flex",flexDirection:"column",overflow:"auto"}),y=r("button",{marginRight:"1em"},"_");let o=!1;y.addEventListener("click",p=>{(o=!o)?(u.style.maxHeight="1.6em",u.style.maxWidth="15em"):(u.style.maxHeight="",u.style.maxWidth="")});const i=r("button",{float:"right"},"\xD7");i.addEventListener("click",t);const l=r("div",{fontWeight:"bold",background:"#123",color:"#eee",padding:"0.1em 1em",cursor:"grab"},i,y,"\u03BC diagnostics"),d=r("div",{whiteSpace:"pre"}),h=r("span",{},"0"),m=r("details",{cursor:"pointer",marginBottom:"1em"},r("summary",{},r("strong",{},"Active effects: "),h),d);let b=-1;setInterval(()=>{let{activeEffects:p,generation:w}=lt();w!==b&&(b=w,d.innerText=[...p.entries()].map(k=>`${k[0]}\xD7${k[1]}`).join(`
`),h.innerText=String(Array.from(p.values()).reduce((k,g)=>k+g,0)))},re);const v=r("button",{},"Undo"),P=r("button",{},"Redo");queueMicrotask(()=>{const{trackHistory:p}=M.options;p||(v.disabled=P.disabled=!0)});const le=M.history,fe=r("span",{},"0"),pe=r("ol",{}),ue=r("details",{cursor:"pointer",marginBottom:"1em"},r("summary",{},r("strong",{},"Recent history: "),fe," total ",v,P),pe);v.addEventListener("click",()=>M.undo()),P.addEventListener("click",()=>M.redo()),setInterval(()=>{if(fe.innerText=String(le.length),ue.open){const p=le.slice(-10).map(ot).map(w=>r("li",{},w));pe.replaceChildren(...p)}},re);const de=r("span",{},"0"),G=qe(),he=r("button",{},"\u21BB");he.addEventListener("click",a);const ye=r("ol",{}),je=r("details",{},r("summary",{cursor:"pointer"},r("strong",{},"Live PropRefs: "),de," ",he),ye);let me=-1;setInterval(()=>{G.generation!==me&&(de.replaceChildren(String(G.sizeBound)),a(),me=G.generation)},re);const N=r("button",{},"\u{1F50D}");N.addEventListener("click",f);const U=r("span",{},"(none)"),Y=r("ol",{}),Ne=r("div",{padding:"1em",overflow:"auto"},N," ",r("strong",{},"Inspected node:")," ",U,Y,m,ue,je);u.append(l,Ne),document.body.append(u);let ge=0,be=0;l.addEventListener("mousedown",p=>{const w=u.getBoundingClientRect();ge=p.x-w.x,be=p.y-w.y,window.addEventListener("mousemove",k),document.body.addEventListener("mouseup",g=>{window.removeEventListener("mousemove",k)},{once:!0}),p.preventDefault();function k(g){u.style.left=g.x-ge+"px",u.style.top=g.y-be+"px"}})}}var Xe,Ye,Ze,et,tt,nt,rt,st;function ot(e){switch(e.type){case"transaction":return`Transaction ${e.transactionName}`;case"create":return`Create property ${String(e.name)}: ${e.newValue}`;case"change":return`Modify property ${String(e.name)}: ${e.newValue}`;case"delete":return`Delete property ${String(e.name)}`;case"arrayextend":return`Extend array to [${e.newIndex}] = ${e.newValue}`;case"arrayshorten":return`Shorten array to ${e.newLength}`;case"setadd":return`Add to set: ${e.newValue}`;case"setdelete":return`Delete from set: ${e.oldValue}`;case"setclear":return"Clear set";case"mapcreate":return`Add new entry to map [${e.key}, ${e.newValue}]`;case"mapchange":return`Change entry in map [${e.key}, ${e.newValue}]`;case"mapdelete":return`Remove key from map ${e.key}`;case"mapclear":return"Clear map";default:}throw new Error("Function not implemented.")}var it={dispose:()=>{}},se=0,L=new Map;function at(e){const t=e.name||"(anonymous)",n=L.get(t);n?L.set(t,n+1):L.set(t,1),++se}function ct(e){const t=e.name||"(anonymous)",n=L.get(t);!n||n<=1?L.delete(t):L.set(t,n-1),++se}function lt(){return{activeEffects:L,generation:se}}function T(e,t={}){const{tracker:n=M,suppressUntrackedWarning:r=!1}=t;let s=n.startDependencyTrack(),c;try{c=e(s)}finally{s.endDependencyTrack()}if(s.trackedProperties.length===0)return r||console.warn("effect() callback has no dependencies on any tracked properties.  It will not fire again."),it;A&&at(e);let a=s.subscribe(o),f=!1,u=!1;function y(){f&&console.error("Effect already disposed"),f=!0,s.untrackAll(),a.dispose(),!u&&A&&ct(e)}function o(i){typeof c=="function"&&c(),u=!0,y(),u=f=!1,s=n.startDependencyTrack(),c=e(s,i),s.endDependencyTrack(),a=s.subscribe(o)}return{dispose:y}}var oe=new WeakMap;function j(e,t){const n=oe.get(e);n?n.push(t):oe.set(e,[t])}function B(e){oe.get(e)?.forEach(n=>n.dispose()),e instanceof Element&&e.childNodes.forEach(B)}var _={suppressUntrackedWarning:!0};function ft(e){return e!=null&&typeof e=="object"&&"$muType"in e&&typeof e.$muType=="string"}function Pe(e,t){if(Array.isArray(t)){t.forEach(n=>Pe(e,n));return}if(!ft(t))throw Error("Expected a node modifier for 'mu:apply', but got "+typeof t);switch(t.$muType){case"attribute":e.setAttribute(t.name,t.value);break;default:throw Error("Unknown node modifier type: "+t.$muType)}}var ie=new WeakMap;function Q(e,t){if(t.trackedProperties.length===0)return;let n=ie.get(e);n||ie.set(e,n=[]),n.push(t)}function De(e){return ie.get(e)}function pt(e,t,n,...r){const s=document.createElement(e);s.append(...r);let c;for(let[o,i]of Object.entries(t))switch(o){case"mu:syncEvent":c=i;break;case"mu:apply":Pe(s,i);break;default:s[o]=i;break}const a=c?[]:void 0;for(let[o,i]of Object.entries(n)){if(a&&o in s){const l=M.getPropRefTolerant(i);l&&a.push([o,l])}switch(o){case"style":{let l=function(h){Object.assign(s.style,i()),A&&Q(s,h)};var f=l;const d=T(l,_);j(s,d);break}case"classList":{let l=function(h){const m=i();for(const[b,v]of Object.entries(m))s.classList.toggle(b,!!v);A&&Q(s,h)};var u=l;const d=T(l,_);j(s,d);break}default:{let l=function(h){s[o]=i(),A&&Q(s,h)};var y=l;const d=T(l,_);j(s,d);break}}}if(c&&a?.length)for(const o of c.matchAll(/\S+/g))s.addEventListener(o[0],()=>{for(const[i,l]of a)l.current=s[i]});return s}function ut(e){let t=document.createTextNode(""),n;return n=T(function(s){const c=e();if(c instanceof Node)s.untrackAll(),t=c;else{const a=document.createTextNode(String(c??""));n&&j(a,n),t.replaceWith(a),t=a,A&&Q(t,s)}},_),j(t,n),t}var R=class{static id=0;startMarker=document.createTextNode("");endMarker=document.createTextNode("");constructor(...e){document.createDocumentFragment().append(this.startMarker,...e,this.endMarker)}removeAsFragment(){if(this.startMarker.parentNode instanceof DocumentFragment)return this.startMarker.parentNode;const e=[];for(let n=this.startMarker;;n=n?.nextSibling){if(n==null)throw Error("End marker not found as subsequent document sibling as start marker");if(e.push(n),Object.is(n,this.endMarker))break}const t=document.createDocumentFragment();return t.append(...e),t}emptyAsFragment(){const e=[];for(let n=this.startMarker.nextSibling;;n=n?.nextSibling){if(n==null)throw Error("End marker not found as subsequent document sibling as start marker");if(Object.is(n,this.endMarker))break;e.push(n)}const t=document.createDocumentFragment();return t.append(...e),t}replaceWith(...e){this.emptyAsFragment(),this.append(...e)}append(...e){const t=document.createDocumentFragment();if(t.append(...e),!this.endMarker.parentNode)throw Error("End marker of ElementSpan has no parent");this.endMarker.parentNode.insertBefore(t,this.endMarker)}registerCleanup(e){j(this.startMarker,e)}cleanup(){B(this.startMarker);for(const e of this.emptyAsFragment().childNodes)B(e)}};function Re(e){return e!=null&&typeof e=="object"&&"node"in e&&e.node instanceof Node}function ae(e){const t=new R,n=T(function(s){for(const a of t.emptyAsFragment().childNodes)B(a);const c=e();if(Re(c))return t.replaceWith(c.node),c.cleanup;if(c!=null){t.replaceWith(c);return}});return t.registerCleanup(n),t.removeAsFragment()}var X={suppressUntrackedWarning:!0};function Me(e,t){if(typeof e=="function")return ae(()=>Me(e(),t));const n=new R,r=[],s=e??[],c=T(function(u){for(let y=r.length;y<s.length;y++){const o={container:new R};r.push(o),o.subscription=T(function(l){o.cleanup?.(),o.container.cleanup();const d=s[y],h=d!==void 0?t(d,y,s):document.createTextNode("");Re(h)?(o.container.replaceWith(h.node),o.cleanup=h.cleanup):h!=null&&(o.container.replaceWith(h),o.cleanup=void 0)},X),n.append(o.container.removeAsFragment())}for(;r.length>s.length;)a(r.pop())},X);return n.registerCleanup({dispose(){r.forEach(a)}}),n.registerCleanup(c),n.removeAsFragment();function a({cleanup:f,container:u,subscription:y}){f?.(),y?.dispose(),u.removeAsFragment(),u.cleanup()}}function Oe(e,t){if(typeof e=="function")return ae(()=>Oe(e(),t));const n=new R,r=[],s=new WeakMap,c=e??[],a=T(function(y){for(let o=r.length;o<c.length;o++){const i=new R;r.push(i),T(function(d){i.emptyAsFragment();const h=c[o];if(h==null)return;if(typeof h!="object")throw Error("Elements must be object in ForEachPersist");let m=s.get(h);if(m==null){d&&(d.active=!1);try{const b=t(h);m=b instanceof HTMLElement?b:new R(b),s.set(h,m)}finally{d&&(d.active=!0)}}m instanceof HTMLElement?i.replaceWith(m):m!=null&&i.replaceWith(m.removeAsFragment())},X),n.append(i.removeAsFragment())}for(;r.length>c.length;)f(r.pop())},X);return n.registerCleanup({dispose(){r.forEach(f)}}),n.registerCleanup(a),n.removeAsFragment();function f(u){u.removeAsFragment(),u.cleanup()}}var dt={suppressUntrackedWarning:!0};function ht(){return document.createTextNode("")}function yt(...e){let t,n,r=!1;function s(){r||c.dispose()}const c=T(function(){let f;for(const{nodeGetter:u,conditionGetter:y}of e)if(!y||y()){f=u;break}if(f??=ht,f!==n){t&&(r=!0,B(t),r=!1),n=f;const u=n();t?.replaceWith(u),j(u,{dispose:s}),t=u}},dt);if(!t)throw Error("Logical error in choose() for mu:if.  No element assigned after first effect invocation.");return t}function mt(e){return document.createTextNode(String(e))}function gt(e,t=document.createTextNode(""),n=mt){const r=new R(t);return e.then(s=>r.replaceWith(s)),e.catch(s=>r.replaceWith(typeof n=="function"?n(s):n)),r.removeAsFragment()}var Ce=new WeakMap;function bt(...e){if(e.some(c=>"pattern"in c&&c.pattern instanceof RegExp&&c.pattern.global))throw Error("Global-flagged route patterns not supported");const t=new R;let n,r=!1;function s(c){const{hash:a}=new URL(c);for(const f of e){let u,y=!1;if("pattern"in f?typeof f.pattern=="string"?y=a===f.pattern:y=!!(u=f.pattern.exec(a)??void 0):y=!0,y){r?n?.cleanup():n?.removeAsFragment(),n=void 0;const{element:o}=f;r=typeof o=="function";const i=typeof o=="function"?o(u):o;if(i instanceof DocumentFragment){let l=Ce.get(i);l||Ce.set(i,l=new R(i)),n=l,t.replaceWith(l.removeAsFragment())}else n=void 0,t.replaceWith(i);f.suppressScroll||window.scrollTo(0,0);return}}t.emptyAsFragment()}return window.addEventListener("hashchange",c=>s(c.newURL)),s(location.href),t.removeAsFragment()}var Le="data-mu-style",wt=String(Math.random()*1e6|0),kt=0;function xt(e){const t=new CSSStyleSheet,n=wt+"-"+ ++kt;for(const[r,s]of Object.entries(e)){const c=`[${Le}="${n}"]`,a=`${c}:is(${r}), ${c} :is(${r}) {}`;t.insertRule(a,0);const f=t.cssRules.item(0);Object.assign(f.style,s)}return document.adoptedStyleSheets.push(t),{$muType:"attribute",name:Le,value:n}}function St(e,t=10){return ce(e,t)}function ce(e,t){if(t<0)throw Error("Maximum depth exceeded.  Maybe there's a reference cycle?");if(typeof e!="object")return e;if(Array.isArray(e))return e.map(r=>ce(r,t-1));if(e.constructor&&e.constructor!==Object)throw Error("Can't clone objects with a prototype chain or instances of classes");return Object.fromEntries(Object.entries(e).map(([n,r])=>[n,ce(r,t-1)]))}var vt="0.23.1";export{Me as ForEach,Oe as ForEachPersist,gt as PromiseLoader,ve as PropReference,bt as Router,ae as Swapper,Te as Tracker,ut as child,yt as choose,S as createOrRetrievePropRef,M as defaultTracker,T as effect,pt as element,F as isTracked,xt as makeLocalStyle,_e as track,St as untrackedClone,vt as version};
