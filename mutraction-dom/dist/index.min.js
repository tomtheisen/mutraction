"use strict";var E=Symbol("RecordMutation"),M=Symbol("TrackerOf"),S=Symbol("ProxyOf"),N=Symbol("RecordDependency"),_=Symbol("GetOriginal"),ee=["copyWithin","fill","pop","push","reverse","shift","sort","splice","unshift"];function te(e){return typeof e=="string"?H(e):typeof e=="number"&&(e&2147483647)===e}function H(e){return typeof e!="string"||!/^\d{1,10}$/.test(e)?!1:parseInt(e,10)<2147483647}function re(e){return Object.prototype.toString.call(e)==="[object Arguments]"}function $(e,t){Object.defineProperty(e,S,{enumerable:!1,writable:!0,configurable:!1}),e[S]=t}var I=new Set([RegExp,Promise]);"window"in globalThis&&I.add(globalThis.window.constructor);function P(e){return!(e==null||typeof e!="object"||T(e)||!Object.isExtensible(e)||I.has(e.constructor))}function C(e,t){function r(n,s,c){if(s===M)return t;if(s===_)return n;t[N](m(n,s));let p=Reflect.get(n,s,c);if(P(p)){const u=p[S];if(u){if(u[M]!==t)throw Error("Object cannot be tracked by multiple tracker instances");p=u}else{const h=p,b=C(h,t);p=n[s]=new Proxy(h,b),$(h,p)}}if(typeof p=="function"&&t.options.autoTransactionalize&&s!=="constructor"){let u=function(){const b=t.startTransaction(h.name??"auto");try{return h.apply(c,arguments)}finally{b.operations.length>0?t.commit(b):t.rollback(b)}};var f=u;const h=p;return u}return p}function o(n,s,c){if(typeof s=="string"&&ee.includes(s)){let f=function(){const h=t.startTransaction(String(s)),b=u.apply(c,arguments);return t.commit(h),b};var p=f;const u=n[s];return f}else return r(n,s,c)}let i=0;function a(n,s,c,p){if(P(c)){const b=C(c,t);c=new Proxy(c,b)}const f=s in n?{type:"change",target:n,name:s,oldValue:e[s],newValue:c,timestamp:new Date}:{type:"create",target:n,name:s,newValue:c,timestamp:new Date},u=i,h=Reflect.set(n,s,c,p);return h&&u==i++&&t[E](f),h}function l(n,s,c,p){if(!Array.isArray(n))throw Error("This object used to be an array.  Expected an array.");if(s==="length"){te(c)||(n.length=c);const f=n.length,u=parseInt(c,10);if(u<f){const h=Object.freeze(n.slice(u,f)),b={type:"arrayshorten",target:n,name:s,oldLength:f,newLength:u,removed:h,timestamp:new Date},D=Reflect.set(n,s,c,p);return t[E](b),++i,D}}if(H(s)){const f=parseInt(s,10);if(f>=n.length){const u={type:"arrayextend",target:n,name:s,oldLength:n.length,newIndex:f,newValue:c,timestamp:new Date},h=Reflect.set(n,s,c,p);return t[E](u),++i,h}}return a(n,s,c,p)}function d(n,s){const c={type:"delete",target:n,name:s,oldValue:e[s],timestamp:new Date},p=Reflect.deleteProperty(n,s);return p&&t[E](c),p}let g=a,y=r;if(Array.isArray(e)&&(g=l,t.options.trackHistory&&(y=o)),re(e))throw Error("Tracking of exotic arguments objects not supported");return{get:y,set:g,deleteProperty:d}}function T(e){return typeof e=="object"&&!!e[M]}var U=class{object;prop;#e=new Set;#t=!1;get subscribers(){return this.#e}constructor(e,t){!T(e)&&e[S]&&(e=e[S]),this.object=e,this.prop=t}subscribe(e){return this.#e.add(e),{dispose:()=>{this.#e.delete(e)}}}notifySubscribers(){this.#t&&console.warn(`Re-entrant property subscription for '${String(this.prop)}'`);const e=Array.from(this.#e);this.#t=!0;for(const t of e)t.notifySubscribers(this);this.#t=!1}get current(){return this.object[this.prop]}set current(e){this.object[this.prop]=e}},G=new WeakMap;function m(e,t){let r=G.get(e);r||G.set(e,r=new Map);let o=r.get(t);return o||r.set(t,o=new U(e,t)),o}var z=class{#e=new Map;#t;#r=!1;#n=new Set;active=!0;constructor(e){this.#t=e}get trackedProperties(){return Array.from(this.#e.keys())}addDependency(e){if(this.active&&!this.#r){if(this.#e.has(e))return;const t=e.subscribe(this);this.#e.set(e,t)}}subscribe(e){return this.#n.add(e),{dispose:()=>this.#n.delete(e)}}notifySubscribers(e){const t=Array.from(this.#n);for(const r of t)r(e)}endDependencyTrack(){this.#t.endDependencyTrack(this)}trackAllChanges(){if(this.#r)return;this.untrackAll();const e=m(this.#t,"history");this.addDependency(e),this.#r=!0}untrackAll(){for(const e of this.#e.values())e.dispose();this.#e.clear()}};function ne({operations:e}){for(let t=0;t<e.length;){const r=e[t];if(r.type==="transaction")e.splice(t,1,...r.operations);else if(r.type==="change"&&Object.is(r.oldValue,r.newValue))e.splice(t,1);else if(t>0){const o=e[t-1];if(o.type==="transaction")throw Error("Internal mutraction error.  Found internal transaction on look-back during packTransaction.");o.target!==r.target||o.name!==r.name?++t:o.type==="create"&&r.type==="change"?e.splice(--t,2,{...o,newValue:r.newValue}):o.type==="create"&&r.type==="delete"?e.splice(--t,2):o.type==="change"&&r.type==="change"?e.splice(--t,2,{...o,newValue:r.newValue}):o.type==="change"&&r.type==="delete"?e.splice(--t,2,{...r,oldValue:o.oldValue}):o.type==="delete"&&r.type==="create"?e.splice(--t,2,{...r,...o,type:"change"}):++t}else++t}}var q={trackHistory:!0,autoTransactionalize:!0,compactOnCommit:!0},B=class{#e;#t;#r=[];#n=!1;#s=[];options=q;#i;constructor(e={}){this.setOptions(e)}setOptions(e={}){if(this.#n)throw Error("Cannot change options for a tracker that has already started tracking");e.trackHistory===!1&&(e.compactOnCommit=!1,e.autoTransactionalize??=!1);const t={...q,...e};if(t.compactOnCommit&&!t.trackHistory)throw Error("Option compactOnCommit requires option trackHistory");t.trackHistory?this.#t=[]:this.#t=void 0,this.options=Object.freeze(t)}track(e){if(T(e))throw Error("Object already tracked");if(this.#n=!0,!P)throw Error("This object type cannot be proxied");const t=new Proxy(e,C(e,this));return $(e,t),t}trackAsReadonlyDeep(e){return this.track(e)}#a(){if(!this.options.trackHistory)throw Error("History tracking disabled.")}get history(){if(this.#a(),this.#s[0]?.trackAllChanges(),this.#i??=m(this,"history"),!this.#t)throw Error("History tracking enabled, but no root transaction. Probably mutraction internal error.");return this.#t}startTransaction(e){return this.#e={type:"transaction",parent:this.#e,operations:[],dependencies:new Set,timestamp:new Date},e&&(this.#e.transactionName=e),this.#e}commit(e){if(!this.#e)throw Error("Attempted to commit transaction when none were open.");if(e&&e!==this.#e)throw Error("Attempted to commit wrong transaction. Transactions must be resolved in stack order.");if(this.options.compactOnCommit&&ne(this.#e),this.#e.parent)this.#e.parent.operations.push(this.#e),this.#e.dependencies.forEach(t=>this.#e.parent.dependencies.add(t)),this.#e=this.#e.parent;else{this.#t?.push(this.#e);const t=new Set;for(const r of this.#e.dependencies)for(const o of r.subscribers)t.add(o);for(const r of t)r.notifySubscribers();this.#e=void 0}this.#e==null&&this.#i?.notifySubscribers()}rollback(e){if(e&&e!==this.#e)throw Error("Attempted to commit wrong transaction. Transactions must be resolved in stack order.");if(this.#e){for(;this.#e.operations.length;)this.undo();this.#e=this.#e.parent}else for(;this.#t?.length;)this.undo()}undo(){this.#a();const e=(this.#e?.operations??this.#t).pop();e&&(this.#l(e),this.#r.unshift(e),this.#e==null&&this.#i?.notifySubscribers())}#l(e){if(e.type==="transaction")for(let t=e.operations.length;t-- >0;)this.#l(e.operations[t]);else{const t=e.target;switch(e.type){case"change":case"delete":t[e.name]=e.oldValue;break;case"create":delete t[e.name];break;case"arrayextend":t.length=e.oldLength;break;case"arrayshorten":t.push(...e.removed);break;default:}this.#e||(m(e.target,e.name).notifySubscribers(),(e.type==="arrayextend"||e.type==="arrayshorten")&&m(e.target,"length").notifySubscribers())}}redo(){this.#a();const e=this.#r.shift();e&&(this.#p(e),(this.#e?.operations??this.#t).push(e),this.#e==null&&this.#i?.notifySubscribers())}#p(e){if(e.type==="transaction")for(const t of e.operations)this.#p(t);else{const t=e.target;switch(e.type){case"change":case"create":t[e.name]=e.newValue;break;case"delete":delete t[e.name];break;case"arrayextend":t[e.newIndex]=e.newValue;break;case"arrayshorten":t.length=e.newLength;break;default:}this.#e||(m(e.target,e.name).notifySubscribers(),(e.type==="arrayextend"||e.type==="arrayshorten")&&m(e.target,"length").notifySubscribers())}}clearRedos(){this.#r.length=0}clearHistory(){this.#a(),this.#e=void 0,this.#t.length=0,this.clearRedos()}[E](e){this.options.trackHistory&&(this.#e?.operations??this.#t).push(Object.freeze(e)),this.clearRedos(),this.#e?(this.#e.dependencies.add(m(e.target,e.name)),(e.type==="arrayextend"||e.type==="arrayshorten")&&this.#e.dependencies.add(m(e.target,"length"))):(m(e.target,e.name).notifySubscribers(),(e.type==="arrayextend"||e.type==="arrayshorten")&&m(e.target,"length").notifySubscribers(),this.#i?.notifySubscribers())}ignoreUpdates(e){const t=this.startDependencyTrack();t.active=!1,e(),t.endDependencyTrack()}startDependencyTrack(){const e=new z(this);return this.#s.unshift(e),e}endDependencyTrack(e){if(this.#s[0]!==e)throw Error("Specified dependency list is not top of stack");return this.#s.shift(),e}[N](e){this.#c?this.#o=e:this.#s[0]?.addDependency(e)}#c=!1;#o=void 0;getPropRef(e){const t=this.getPropRefTolerant(e);if(!t)throw Error("No tracked properties.  Prop ref detection requires a tracked object.");return t}getPropRefTolerant(e){if(this.#c)throw Error("Cannot be called re-entrantly.");this.#c=!0,this.#o=void 0;try{const t=e();if(!this.#o)return;const r=this.#o.current;return Object.is(t,r)||console.error("The last operation of the callback must be a property get.\n`(foo || bar).quux` is allowed, but `foo.bar + 1` is not"),this.#o}finally{this.#c=!1}}},A=new B;function se(e){return A.track(e)}var ie={dispose:()=>{}};function k(e,t={}){const{tracker:r=A,suppressUntrackedWarning:o=!1}=t;let i=r.startDependencyTrack(),a;try{a=e(i)}finally{i.endDependencyTrack()}if(i.trackedProperties.length===0)return o||console.warn("effect() callback has no dependencies on any tracked properties.  It will not fire again."),ie;let l=i.subscribe(g);const d=()=>{i.untrackAll(),l.dispose()};function g(y){typeof a=="function"&&a(),d(),i=r.startDependencyTrack(),a=e(i,y),i.endDependencyTrack(),l=i.subscribe(g)}return{dispose:d}}var F=new WeakMap;function v(e,t){const r=F.get(e);r?r.push(t):F.set(e,[t])}function x(e){F.get(e)?.forEach(r=>r.dispose()),e instanceof Element&&e.childNodes.forEach(r=>x(r))}var O={suppressUntrackedWarning:!0};function oe(e){return e!=null&&typeof e=="object"&&"$muType"in e&&typeof e.$muType=="string"}function V(e,t){if(Array.isArray(t)){t.forEach(r=>V(e,r));return}if(!oe(t))throw Error("Expected a node modifier for 'mu:apply', but got "+typeof t);switch(t.$muType){case"attribute":e.setAttribute(t.name,t.value);break;default:throw Error("Unknown node modifier type: "+t.$muType)}}function ae(e,t,r,...o){const i=document.createElement(e);i.append(...o);let a,l=!1,d=0,g=!1;for(let[n,s]of Object.entries(t))switch(n){case"mu:syncEvent":a=s;break;case"mu:apply":V(i,s);break;case"mu:diagnostic":l=!0;break;default:i[n]=s;break}l&&console.trace(`[mu:diagnostic] Creating ${e}`);const y=a?[]:void 0;for(let[n,s]of Object.entries(r)){if(y&&n in i){const c=A.getPropRefTolerant(s);c&&y.push([n,c])}switch(n){case"style":{const p=k(l?function(u,h){g&&console.trace(`[mu:diagnostic] Updating ${e}`,{attribute:n,trigger:h,updates:++d}),Object.assign(i.style,s())}:function(){Object.assign(i.style,s())},O);v(i,p);break}case"classList":{const p=k(l?function(u,h){g&&console.trace(`[mu:diagnostic] Updating ${e}`,{attribute:n,trigger:h,updates:++d});const b=s();for(const[D,Z]of Object.entries(b))i.classList.toggle(D,!!Z)}:function(){const u=s();for(const[h,b]of Object.entries(u))i.classList.toggle(h,!!b)},O);v(i,p);break}default:{const p=k(l?function(u,h){g&&console.trace(`[mu:diagnostic] Updating ${e}`,{attribute:n,trigger:h,updates:++d}),i[n]=s()}:function(){i[n]=s()},O);v(i,p);break}}}if(a&&y?.length)for(const n of a.matchAll(/\S+/g))i.addEventListener(n[0],()=>{for(const[s,c]of y)c.current=i[s]});return g=!0,i}function ce(e){let t=document.createTextNode(""),r;return r=k(function(i){const a=e();if(a instanceof Node)i.untrackAll(),t=a;else{const l=document.createTextNode(String(a??""));r&&v(l,r),t.replaceWith(l),t=l}},O),v(t,r),t}var w=class{static id=0;startMarker=document.createTextNode("");endMarker=document.createTextNode("");constructor(...e){document.createDocumentFragment().append(this.startMarker,...e,this.endMarker)}removeAsFragment(){if(this.startMarker.parentNode instanceof DocumentFragment)return this.startMarker.parentNode;const e=[];for(let r=this.startMarker;;r=r?.nextSibling){if(r==null)throw Error("End marker not found as subsequent document sibling as start marker");if(e.push(r),Object.is(r,this.endMarker))break}const t=document.createDocumentFragment();return t.append(...e),t}emptyAsFragment(){const e=[];for(let r=this.startMarker.nextSibling;;r=r?.nextSibling){if(r==null)throw Error("End marker not found as subsequent document sibling as start marker");if(Object.is(r,this.endMarker))break;e.push(r)}const t=document.createDocumentFragment();return t.append(...e),t}replaceWith(...e){this.emptyAsFragment(),this.append(...e)}append(...e){const t=document.createDocumentFragment();if(t.append(...e),!this.endMarker.parentNode)throw Error("End marker of ElementSpan has no parent");this.endMarker.parentNode.insertBefore(t,this.endMarker)}registerCleanup(e){v(this.startMarker,e)}cleanup(){x(this.startMarker);for(const e of this.emptyAsFragment().childNodes)x(e)}};function J(e){return e!=null&&typeof e=="object"&&"node"in e&&e.node instanceof Node}function j(e){const t=new w;let r;const o=k(function(a){r?.(),r=void 0,t.cleanup();const l=e();J(l)?(t.replaceWith(l.node),r=l.cleanup):l!=null&&t.replaceWith(l)});return t.registerCleanup(o),t.removeAsFragment()}var R={suppressUntrackedWarning:!0};function K(e,t){if(typeof e=="function")return j(()=>K(e(),t));const r=new w,o=[],i=e??[],a=k(function(g){for(let y=o.length;y<i.length;y++){const n={container:new w};o.push(n),n.subscription=k(function(c){n.cleanup?.();const p=i[y],f=p!==void 0?t(p,y,i):document.createTextNode("");J(f)?(n.container.replaceWith(f.node),n.cleanup=f.cleanup):f!=null&&(n.container.replaceWith(f),n.cleanup=void 0)},R),r.append(n.container.removeAsFragment())}for(;o.length>i.length;)l(o.pop())},R);return r.registerCleanup({dispose(){o.forEach(l)}}),r.registerCleanup(a),r.removeAsFragment();function l({cleanup:d,container:g,subscription:y}){d?.(),y?.dispose(),g.removeAsFragment(),g.cleanup()}}function Q(e,t){if(typeof e=="function")return j(()=>Q(e(),t));const r=new w,o=[],i=new WeakMap,a=e??[],l=k(function(y){for(let n=o.length;n<a.length;n++){const s=new w;o.push(s),k(function(p){s.emptyAsFragment();const f=a[n];if(f==null)return;if(typeof f!="object")throw Error("Elements must be object in ForEachPersist");let u=i.get(f);if(u==null){p&&(p.active=!1);try{const h=t(f);u=h instanceof HTMLElement?h:new w(h),i.set(f,u)}finally{p&&(p.active=!0)}}u instanceof HTMLElement?s.replaceWith(u):u!=null&&s.replaceWith(u.removeAsFragment())},R),r.append(s.removeAsFragment())}for(;o.length>a.length;)d(o.pop())},R);return r.registerCleanup({dispose(){o.forEach(d)}}),r.registerCleanup(l),r.removeAsFragment();function d(g){g.removeAsFragment(),g.cleanup()}}var le={suppressUntrackedWarning:!0};function W(){return document.createTextNode("")}function pe(...e){let t=W(),r=W;return k(function(){let i;for(const{nodeGetter:a,conditionGetter:l}of e)if(!l||l()){i=a;break}if(i??=W,i!==r){x(t),r=i;const a=r();t.replaceWith(a),t=a}},le),t}function fe(e){return document.createTextNode(String(e))}function ue(e,t=document.createTextNode(""),r=fe){const o=new w(t);return e.then(i=>o.replaceWith(i)),e.catch(i=>o.replaceWith(typeof r=="function"?r(i):r)),o.removeAsFragment()}var X=new WeakMap;function he(...e){if(e.some(a=>"pattern"in a&&a.pattern instanceof RegExp&&a.pattern.global))throw Error("Global-flagged route patterns not supported");const t=new w;let r,o=!1;function i(a){const{hash:l}=new URL(a);for(const d of e){let g,y=!1;if("pattern"in d?typeof d.pattern=="string"?y=l===d.pattern:y=!!(g=d.pattern.exec(l)??void 0):y=!0,y){o?r?.cleanup():r?.removeAsFragment(),r=void 0;const{element:n}=d;o=typeof n=="function";const s=typeof n=="function"?n(g):n;if(s instanceof DocumentFragment){let c=X.get(s);c||X.set(s,c=new w(s)),r=c,t.replaceWith(c.removeAsFragment())}else r=void 0,t.replaceWith(s);d.suppressScroll||window.scrollTo(0,0);return}}t.emptyAsFragment()}return window.addEventListener("hashchange",a=>i(a.newURL)),i(location.href),t.removeAsFragment()}var Y="data-mu-style",de=String(Math.random()*1e6|0),ye=0;function ge(e){const t=new CSSStyleSheet,r=de+"-"+ ++ye;for(const[o,i]of Object.entries(e)){const a=`[${Y}="${r}"]`,l=`${a}:is(${o}), ${a} :is(${o}) {}`;t.insertRule(l,0);const d=t.cssRules.item(0);Object.assign(d.style,i)}return document.adoptedStyleSheets.push(t),{$muType:"attribute",name:Y,value:r}}function be(e,t=10){return L(e,t)}function L(e,t){if(t<0)throw Error("Maximum depth exceeded.  Maybe there's a reference cycle?");if(typeof e!="object")return e;if(Array.isArray(e))return e.map(o=>L(o,t-1));if(e.constructor&&e.constructor!==Object)throw Error("Can't clone objects with a prototype chain or instances of classes");return Object.fromEntries(Object.entries(e).map(([r,o])=>[r,L(o,t-1)]))}var me="0.22.3";export{z as DependencyList,K as ForEach,Q as ForEachPersist,ue as PromiseLoader,U as PropReference,he as Router,j as Swapper,B as Tracker,ce as child,pe as choose,m as createOrRetrievePropRef,A as defaultTracker,k as effect,ae as element,T as isTracked,ge as makeLocalStyle,se as track,be as untrackedClone,me as version};
